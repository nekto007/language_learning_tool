{% extends 'base.html' %}

{% block title %}{{ _('–í—ã–±—Ä–∞—Ç—å –∫–Ω–∏–≥—É –¥–ª—è —á—Ç–µ–Ω–∏—è - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ') }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">üìö {{ _('–í–∞—à–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ —á—Ç–µ–Ω–∏–∏') }}</h1>
                <p class="lead mb-4">{{ _('–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å, –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–µ –∫–Ω–∏–≥–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–≤–æ–µ–≥–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ.') }}</p>
            </div>
            <div class="col-lg-4">
                <div class="stats-card">
                    <div class="stats-number">{{ books_started }}</div>
                    <div>{{ _('–ö–Ω–∏–≥ –Ω–∞—á–∞—Ç–æ') }}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <!-- Recent Books Section -->
    {% if recent_books %}
    <section class="mb-5">
        <div class="section-header">
            <h2 class="h3 mb-0">
                <i class="fas fa-history text-primary me-2"></i>
                {{ _('–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á—Ç–µ–Ω–∏–µ') }}
            </h2>
        </div>
        
        <div class="row g-4">
            {% for book, progress in recent_books[:6] %}
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="card">
                    <div class="book-cover-wrapper">
                        {% if book.cover_image %}
                        <img src="{{ url_for('uploads.serve_cover', filename=book.cover_image.split('/')[-1]) }}" 
                             alt="{{ book.title }}" 
                             class="book-cover-img">
                        {% else %}
                        <div class="no-cover">
                            <i class="fas fa-book"></i>
                            <div>{{ _('–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏') }}</div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="book-info">
                        <h3 class="book-title">{{ book.title }}</h3>
                        {% if book.author %}
                        <div class="book-author">{{ book.author }}</div>
                        {% endif %}
                        
                        <div class="progress-info">
                            <div class="progress-bar-wrapper">
                                <div class="progress-bar-fill" style="width: {{ (progress.position / 1000) }}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>{{ _('–ü—Ä–æ–≥—Ä–µ—Å—Å') }}</span>
                                <span>{{ progress.last_read.strftime('%b %d') }}</span>
                            </div>
                        </div>
                        
                        <a href="{{ url_for('books.read_book', book_id=book.id) }}"
                           class="btn btn-primary btn-block mt-3">
                            <i class="fas fa-play-circle me-2"></i>{{ _('–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å') }}
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- All Books Section -->
    <section>
        <div class="section-header">
            <h2 class="h3 mb-0">
                <i class="fas fa-book-open text-success me-2"></i>
                {{ _('–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–∏–≥–∏') }}
            </h2>
        </div>

        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" 
                   class="form-control search-input" 
                   id="bookSearch" 
                   placeholder="{{ _('–ü–æ–∏—Å–∫ –∫–Ω–∏–≥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä—É...') }}">
        </div>

        {% if all_books %}
        <div class="row g-4" id="booksGrid">
            {% for book in all_books %}
            <div class="col-lg-3 col-md-4 col-sm-6 book-item" 
                 data-title="{{ book.title.lower() }}" 
                 data-author="{{ book.author.lower() if book.author else '' }}">
                <div class="card">
                    <div class="book-cover-wrapper">
                        {% if book.cover_image %}
                        <img src="{{ url_for('uploads.serve_cover', filename=book.cover_image.split('/')[-1]) }}" 
                             alt="{{ book.title }}" 
                             class="book-cover-img">
                        {% else %}
                        <div class="no-cover">
                            <i class="fas fa-book"></i>
                            <div>{{ _('–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏') }}</div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="book-info">
                        <h3 class="book-title">{{ book.title }}</h3>
                        {% if book.author %}
                        <div class="book-author">{{ book.author }}</div>
                        {% endif %}
                        
                        {% if book.level %}
                        <span class="badge bg-info mb-2">{{ book.level }}</span>
                        {% endif %}
                        
                        <a href="{{ url_for('books.read_book', book_id=book.id) }}"
                           class="btn btn-success btn-block mt-auto">
                            <i class="fas fa-book-reader me-2"></i>{{ _('–ù–∞—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ') }}
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-book-open"></i>
            <h3>{{ _('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–Ω–∏–≥') }}</h3>
            <p>{{ _('–ö–Ω–∏–≥–∏ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.') }}</p>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Search functionality
document.getElementById('bookSearch').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const bookItems = document.querySelectorAll('.book-item');
    
    bookItems.forEach(item => {
        const title = item.dataset.title;
        const author = item.dataset.author;
        
        if (title.includes(searchTerm) || author.includes(searchTerm)) {
            item.style.display = '';
        } else {
            item.style.display = 'none';
        }
    });
});

// Animate progress bars on load
document.addEventListener('DOMContentLoaded', function() {
    const progressBars = document.querySelectorAll('.progress-bar-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0';
        setTimeout(() => {
            bar.style.width = width;
        }, 100);
    });
});
</script>
{% endblock %}