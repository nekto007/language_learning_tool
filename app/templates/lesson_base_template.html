{% extends "base.html" %}

{% block content %}
<div class="container lesson-page">
  <!-- Compact Breadcrumb -->
  <nav aria-label="breadcrumb" class="lesson-breadcrumb">
    <ol class="breadcrumb-minimal">
      <li><a href="{{ url_for('curriculum.index') }}">{{ _('–ö—É—Ä—Å—ã') }}</a></li>
      <li>/</li>
      <li><a href="{{ url_for('curriculum.level_modules', level_code=lesson.module.level.code) }}">{{ lesson.module.level.code }}</a></li>
      <li>/</li>
      <li><a href="{{ url_for('curriculum.module_lessons', module_id=lesson.module_id) }}">{{ _('–ú–æ–¥—É–ª—å') }} {{ lesson.module.number }}</a></li>
      <li>/</li>
      <li class="active">{{ _('–£—Ä–æ–∫') }} {{ lesson.number }}</li>
    </ol>
  </nav>

  <!-- Compact Header -->
  <div class="lesson-header">
    <div class="lesson-header-left">
      <span class="lesson-type-badge">
        {% if lesson.type == 'vocabulary' %}
          üìö
        {% elif lesson.type == 'grammar' %}
          ‚úçÔ∏è
        {% elif lesson.type == 'quiz' %}
          ‚ùì
        {% elif lesson.type == 'text' %}
          üìÑ
        {% elif lesson.type in ['card', 'anki_cards'] %}
          üóÇÔ∏è
        {% elif lesson.type == 'final_test' %}
          üèÜ
        {% else %}
          üéì
        {% endif %}
        {{ component_name|default(translate_lesson_type(lesson.type)) }}
      </span>
      <h1 class="lesson-title">{{ lesson.title }}</h1>
    </div>
    <div class="lesson-progress-compact">
      <span class="progress-text">{{ lesson.number }}/{{ total_lessons|default(7) }}</span>
      <div class="progress-bar-mini">
        <div class="progress-fill-mini" style="width: {{ ((lesson.number / total_lessons|default(7)) * 100)|round }}%"></div>
      </div>
    </div>
  </div>

  {% if lesson.description or block_description %}
  <p class="lesson-description">{{ lesson.description or block_description|default('') }}</p>
  {% endif %}

  <!-- Instructions -->
  {% if instruction_text %}
  <div class="instruction-box">
    <i class="fas fa-info-circle"></i>
    <span>{{ instruction_text }}</span>
  </div>
  {% endif %}

  <!-- Main Content -->
  <div class="lesson-content">
    {% block lesson_content %}{% endblock %}
  </div>

  <!-- Navigation Footer -->
  <div class="lesson-footer" id="lesson-footer">
    {% block action_buttons %}
      <a href="{{ url_for('curriculum.module_lessons', module_id=lesson.module_id) }}"
         class="btn-lesson btn-outline">
        ‚Üê {{ _('–ö –º–æ–¥—É–ª—é') }}
      </a>

      <button type="button"
              class="btn-lesson btn-outline"
              id="retry-button"
              style="display: none;"
              onclick="retryLesson()">
        <i class="fas fa-redo"></i> {{ _('–ó–∞–Ω–æ–≤–æ') }}
      </button>

      {% if next_lesson %}
        <button type="button"
                class="btn-lesson btn-primary"
                id="complete-exercise"
                style="display: none;"
                data-next-url="{{ url_for('curriculum_lessons.lesson_detail', lesson_id=next_lesson.id) }}"
                onclick="window.location.href=this.getAttribute('data-next-url')">
          {{ _('–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫') }} ‚Üí
        </button>
      {% else %}
        <button type="button"
                class="btn-lesson btn-primary"
                id="complete-module"
                style="display: none;"
                onclick="window.location.href='{{ url_for('curriculum.module_lessons', module_id=lesson.module_id) }}'">
          <i class="fas fa-check"></i> {{ _('–ó–∞–≤–µ—Ä—à–∏—Ç—å') }}
        </button>
      {% endif %}
    {% endblock %}
  </div>

</div>

<!-- CSRF Token Meta -->
<meta name="csrf-token" content="{{ csrf_token() }}">
{% endblock %}
