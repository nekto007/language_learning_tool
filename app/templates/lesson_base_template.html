{% extends "base.html" %}

{% block content %}
<div class="container py-4">
  <!-- Минималистичная навигация -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb-minimal">
      <li><a href="{{ url_for('curriculum.index') }}">{{ _('Курсы') }}</a></li>
      <li>/</li>
      <li><a href="{{ url_for('curriculum.level_modules', level_code=lesson.module.level.code) }}">{{ lesson.module.level.code }}</a></li>
      <li>/</li>
      <li><a href="{{ url_for('curriculum.module_lessons', module_id=lesson.module_id) }}">{{ _('Модуль') }} {{ lesson.module.number }}</a></li>
      <li>/</li>
      <li class="active">{{ _('Урок') }} {{ lesson.number }}</li>
    </ol>
  </nav>

  <!-- Заголовок урока -->
  <div class="lesson-intro mb-5">
    <div class="lesson-type-badge mb-3">
      <span class="badge-icon">
        {% if lesson.type == 'vocabulary' %}
          <i class="fas fa-book"></i>
        {% elif lesson.type == 'grammar' %}
          <i class="fas fa-pen"></i>
        {% elif lesson.type == 'quiz' %}
          <i class="fas fa-question-circle"></i>
        {% elif lesson.type == 'text' %}
          <i class="fas fa-file-alt"></i>
        {% elif lesson.type in ['card', 'anki_cards'] %}
          <i class="fas fa-clone"></i>
        {% elif lesson.type == 'final_test' %}
          <i class="fas fa-trophy"></i>
        {% else %}
          <i class="fas fa-graduation-cap"></i>
        {% endif %}
      </span>
      <span class="badge-text">{{ component_name|default(translate_lesson_type(lesson.type)) }}</span>
    </div>

    <h1 class="lesson-title">{{ lesson.title }}</h1>
    <p class="lesson-description">{{ lesson.description or block_description|default('') }}</p>
  </div>

  <!-- Прогресс модуля -->
  <div class="lesson-progress-bar mb-5">
    <div class="progress-header">
      <span class="progress-label">{{ _('Прогресс модуля') }}</span>
      <span class="progress-value">{{ lesson.number }} / {{ total_lessons|default(7) }}</span>
    </div>
    <div class="progress-track">
      <div class="progress-fill" style="width: {{ ((lesson.number / total_lessons|default(7)) * 100)|round }}%"></div>
    </div>
  </div>

  <!-- Основной контент -->
  <div class="lesson-content-wrapper">
    <!-- Инструкции (если есть) -->
    {% if instruction_text %}
    <div class="instruction-card mb-4">
      <i class="fas fa-info-circle"></i>
      <span>{{ instruction_text }}</span>
    </div>
    {% endif %}

    <!-- Основная карточка контента -->
    <div class="content-card">
      {% block lesson_content %}{% endblock %}
    </div>

    <!-- Навигация -->
    <div class="lesson-navigation mt-5" id="lesson-footer">
      <div class="nav-center">
        {% block action_buttons %}
          <!-- Кнопка возврата к модулю -->
          <a href="{{ url_for('curriculum.module_lessons', module_id=lesson.module_id) }}" 
             class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> {{ _('Вернуться к модулю') }}
          </a>
          
          <!-- Кнопка повторного прохождения (скрыта по умолчанию) -->
          <button type="button" 
                  class="btn btn-outline-primary" 
                  id="retry-button"
                  style="display: none;"
                  onclick="retryLesson()">
            <i class="fas fa-redo"></i> {{ _('Пройти заново') }}
          </button>
          
          {% if next_lesson %}
            <button type="button" 
                    class="btn btn-primary btn-next" 
                    id="complete-exercise" 
                    style="display: none;"
                    data-next-url="{{ url_for('curriculum_lessons.lesson_detail', lesson_id=next_lesson.id) }}"
                    onclick="window.location.href=this.getAttribute('data-next-url')">
              {{ _('Следующий урок') }} <i class="fas fa-arrow-right"></i>
            </button>
          {% else %}
            <button type="button" 
                    class="btn btn-primary" 
                    id="complete-module"
                    style="display: none;"
                    onclick="window.location.href='{{ url_for('curriculum.module_lessons', module_id=lesson.module_id) }}'">
              <i class="fas fa-check"></i> {{ _('Завершить модуль') }}
            </button>
          {% endif %}
        {% endblock %}
      </div>
    </div>
  </div>

</div>

<!-- CSRF Token Meta -->
<meta name="csrf-token" content="{{ csrf_token() }}">
{% endblock %}

