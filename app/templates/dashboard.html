{% extends 'base.html' %}

{% block title %}Dashboard - LLT English{% endblock %}

{% block styles %}
{{ super() }}
<style>
:root {
    --dash-bg: #f8fafc;
    --dash-card: #ffffff;
    --dash-card-hover: #ffffff;
    --dash-border: #e2e8f0;
    --dash-text: #1e293b;
    --dash-muted: #64748b;
    --dash-accent: #7c3aed;
    --dash-accent-soft: rgba(124, 58, 237, 0.1);
    --dash-green: #16a34a;
    --dash-green-soft: rgba(22, 163, 74, 0.1);
    --dash-blue: #2563eb;
    --dash-blue-soft: rgba(37, 99, 235, 0.1);
    --dash-orange: #ea580c;
    --dash-orange-soft: rgba(234, 88, 12, 0.1);
    --dash-pink: #db2777;
    --dash-pink-soft: rgba(219, 39, 119, 0.1);
}

.dashboard-page {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--dash-bg);
    min-height: 100vh;
    padding: 2rem 0;
}

.dashboard-page h1, .dashboard-page h2, .dashboard-page h3, .dashboard-page .stat-number {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.dash-header {
    margin-bottom: 2.5rem;
}

.dash-greeting {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--dash-text);
    margin: 0;
    letter-spacing: -0.02em;
}

.dash-subtitle {
    color: var(--dash-muted);
    font-size: 1.1rem;
    margin-top: 0.5rem;
}

/* Bento Grid */
.bento-grid {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 1.25rem;
}

.bento-card {
    background: var(--dash-card);
    border: 1px solid var(--dash-border);
    border-radius: 20px;
    padding: 1.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
}

.bento-card:hover {
    background: var(--dash-card-hover);
    border-color: var(--card-accent, var(--dash-accent));
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
}

.bento-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--card-accent, var(--dash-accent)), transparent);
    opacity: 0;
    transition: opacity 0.3s;
}

.bento-card:hover::before {
    opacity: 1;
}

/* Card Sizes */
.card-wide { grid-column: span 8; }
.card-medium { grid-column: span 6; }
.card-small { grid-column: span 4; }
.card-full { grid-column: span 12; }
.card-third { grid-column: span 4; }

/* Card Header */
.card-icon {
    width: 48px;
    height: 48px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    margin-bottom: 1rem;
}

.card-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--dash-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
}

.card-heading {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dash-text);
    margin: 0;
}

/* Stats */
.stat-number {
    font-size: 3.5rem;
    font-weight: 700;
    line-height: 1;
    color: var(--dash-text);
}

.stat-label {
    color: var(--dash-muted);
    font-size: 0.9rem;
    margin-top: 0.25rem;
}

.stat-row {
    display: flex;
    gap: 2rem;
    margin-top: 1.5rem;
}

.stat-item {
    text-align: center;
}

.stat-item .num {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--dash-text);
}

.stat-item .label {
    font-size: 0.75rem;
    color: var(--dash-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Progress Bar */
.progress-track {
    height: 8px;
    background: var(--dash-border);
    border-radius: 4px;
    overflow: hidden;
    margin-top: 1rem;
}

.progress-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
}

/* Action Button */
.card-action {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.2s;
    margin-top: 1.25rem;
}

.card-action:hover {
    transform: scale(1.02);
}

.card-action i {
    font-size: 0.8rem;
}

/* Accent Colors */
.accent-purple { --card-accent: var(--dash-accent); }
.accent-green { --card-accent: var(--dash-green); }
.accent-blue { --card-accent: var(--dash-blue); }
.accent-orange { --card-accent: var(--dash-orange); }
.accent-pink { --card-accent: var(--dash-pink); }

.bg-accent-purple { background: var(--dash-accent-soft); color: var(--dash-accent); }
.bg-accent-green { background: var(--dash-green-soft); color: var(--dash-green); }
.bg-accent-blue { background: var(--dash-blue-soft); color: var(--dash-blue); }
.bg-accent-orange { background: var(--dash-orange-soft); color: var(--dash-orange); }
.bg-accent-pink { background: var(--dash-pink-soft); color: var(--dash-pink); }

.btn-accent-purple { background: var(--dash-accent); color: white; }
.btn-accent-green { background: var(--dash-green); color: white; }
.btn-accent-blue { background: var(--dash-blue); color: white; }
.btn-accent-orange { background: var(--dash-orange); color: white; }
.btn-accent-pink { background: var(--dash-pink); color: white; }

/* Mini Stats Row */
.mini-stats {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
}

.mini-stat {
    flex: 1;
    background: var(--dash-bg);
    border-radius: 10px;
    padding: 0.75rem;
    text-align: center;
}

.mini-stat .value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--dash-text);
}

.mini-stat .label {
    font-size: 0.7rem;
    color: var(--dash-muted);
    text-transform: uppercase;
}

/* Book Continue Card */
.book-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1rem;
    padding: 1rem;
    background: var(--dash-bg);
    border-radius: 12px;
}

.book-cover {
    width: 48px;
    height: 64px;
    background: linear-gradient(135deg, var(--dash-blue), var(--dash-accent));
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
}

.book-details h4 {
    margin: 0;
    font-size: 1rem;
    color: var(--dash-text);
}

.book-details p {
    margin: 0.25rem 0 0;
    font-size: 0.8rem;
    color: var(--dash-muted);
}

/* Quick Links */
.quick-links {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
    margin-top: 1rem;
}

.quick-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: var(--dash-bg);
    border-radius: 12px;
    text-decoration: none;
    color: var(--dash-text);
    transition: all 0.2s;
    border: 1px solid var(--dash-border);
}

.quick-link:hover {
    background: var(--dash-accent-soft);
    color: var(--dash-accent);
    border-color: var(--dash-accent);
}

.quick-link i {
    font-size: 1.1rem;
    opacity: 0.7;
}

.quick-link span {
    font-size: 0.9rem;
    font-weight: 500;
}

/* Responsive */
@media (max-width: 1024px) {
    .card-wide { grid-column: span 12; }
    .card-medium { grid-column: span 6; }
    .card-small { grid-column: span 6; }
    .card-third { grid-column: span 6; }
}

@media (max-width: 768px) {
    .bento-grid { gap: 1rem; }
    .card-wide, .card-medium, .card-small, .card-third { grid-column: span 12; }
    .dash-greeting { font-size: 1.75rem; }
    .stat-number { font-size: 2.5rem; }
    .stat-row { flex-wrap: wrap; gap: 1rem; }
    .quick-links { grid-template-columns: 1fr; }
}

/* Override base styles for dark theme */
.dashboard-page .container {
    max-width: 1200px;
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-page">
    <div class="container">
        <!-- Header -->
        <div class="dash-header">
            <h1 class="dash-greeting">–ü—Ä–∏–≤–µ—Ç, {{ current_user.username }} <span style="font-size: 0.7em;">üëã</span></h1>
            <p class="dash-subtitle">–í—ã–±–µ—Ä–∏, —á–µ–º —Ö–æ—á–µ—à—å –∑–∞–Ω—è—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è</p>
        </div>

        <!-- Bento Grid -->
        <div class="bento-grid">

            <!-- –ö–ê–†–¢–û–ß–ö–ò (Words) - Large Card -->
            <div class="bento-card card-wide accent-purple">
                <div class="card-icon bg-accent-purple">
                    <i class="fas fa-clone"></i>
                </div>
                <div class="card-title">–ö–∞—Ä—Ç–æ—á–∫–∏</div>
                <div class="d-flex justify-content-between align-items-end">
                    <div>
                        <div class="stat-number">{{ words_total }}</div>
                        <div class="stat-label">—Å–ª–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</div>
                    </div>
                    <div class="stat-row" style="margin: 0;">
                        <div class="stat-item">
                            <div class="num" style="color: var(--dash-orange);">{{ words_stats.learning }}</div>
                            <div class="label">–£—á—É</div>
                        </div>
                        <div class="stat-item">
                            <div class="num" style="color: var(--dash-blue);">{{ words_stats.review }}</div>
                            <div class="label">–ü–æ–≤—Ç–æ—Ä</div>
                        </div>
                        <div class="stat-item">
                            <div class="num" style="color: var(--dash-green);">{{ words_stats.mastered }}</div>
                            <div class="label">–í—ã—É—á–µ–Ω–æ</div>
                        </div>
                    </div>
                </div>
                {% if words_total > 0 %}
                <div class="progress-track">
                    <div class="progress-fill" style="width: {{ (words_stats.mastered / words_total * 100) | int }}%; background: var(--dash-green);"></div>
                </div>
                {% endif %}
                <a href="{{ url_for('study.index') }}" class="card-action btn-accent-purple">
                    –£—á–∏—Ç—å —Å–ª–æ–≤–∞ <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- GRAMMAR LAB - Medium Card -->
            <div class="bento-card card-small accent-pink">
                <div class="card-icon bg-accent-pink">
                    <i class="fas fa-flask"></i>
                </div>
                <div class="card-title">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</div>
                <div class="stat-number">{{ grammar_studied }}<span style="font-size: 0.4em; color: var(--dash-muted);">/{{ grammar_total }}</span></div>
                <div class="stat-label">—Ç–µ–º –∏–∑—É—á–µ–Ω–æ</div>
                <div class="mini-stats">
                    <div class="mini-stat">
                        <div class="value">{{ grammar_mastered }}</div>
                        <div class="label">–û—Å–≤–æ–µ–Ω–æ</div>
                    </div>
                    <div class="mini-stat">
                        <div class="value">{{ grammar_total - grammar_studied }}</div>
                        <div class="label">–û—Å—Ç–∞–ª–æ—Å—å</div>
                    </div>
                </div>
                <a href="{{ url_for('grammar_lab.index') }}" class="card-action btn-accent-pink">
                    Grammar Lab <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- –ö–£–†–°–´ - Medium Card -->
            <div class="bento-card card-medium accent-blue">
                <div class="card-icon bg-accent-blue">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="card-title">–ö—É—Ä—Å—ã</div>
                {% if active_course %}
                <div class="card-heading">{{ active_course.course.title }}</div>
                <p style="color: var(--dash-muted); margin: 0.5rem 0;">{{ active_course.course.book.title if active_course.course.book else '–ê–∫—Ç–∏–≤–Ω—ã–π –∫—É—Ä—Å' }}</p>
                <div class="progress-track">
                    <div class="progress-fill" style="width: {{ active_course.progress_percentage | int }}%; background: var(--dash-blue);"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                    <span style="color: var(--dash-muted); font-size: 0.85rem;">–ü—Ä–æ–≥—Ä–µ—Å—Å: {{ active_course.progress_percentage | int }}%</span>
                    <span style="color: var(--dash-text); font-size: 0.85rem; font-weight: 600;">{{ active_course.course.level or 'A1' }}</span>
                </div>
                {% else %}
                <div class="stat-number">{{ courses_enrolled }}</div>
                <div class="stat-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</div>
                <p style="color: var(--dash-muted); margin-top: 1rem; font-size: 0.9rem;">–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å –∏ –Ω–∞—á–Ω–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ</p>
                {% endif %}
                <a href="{{ url_for('book_courses.list_book_courses') }}" class="card-action btn-accent-blue">
                    {% if active_course %}–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å{% else %}–í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å{% endif %} <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- –ö–ù–ò–ì–ò - Medium Card -->
            <div class="bento-card card-medium accent-green">
                <div class="card-icon bg-accent-green">
                    <i class="fas fa-book-open"></i>
                </div>
                <div class="card-title">–ö–Ω–∏–≥–∏</div>
                {% if recent_book %}
                <div class="card-heading">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á—Ç–µ–Ω–∏–µ</div>
                <div class="book-info">
                    <div class="book-cover">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="book-details">
                        <h4>{{ recent_book.chapter.book.title }}</h4>
                        <p>{{ recent_book.chapter.book.author or '–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω' }}</p>
                    </div>
                </div>
                {% else %}
                <div class="stat-number">{{ books_reading }}</div>
                <div class="stat-label">–∫–Ω–∏–≥ —á–∏—Ç–∞–µ—Ç–µ</div>
                <p style="color: var(--dash-muted); margin-top: 1rem; font-size: 0.9rem;">–ß–∏—Ç–∞–π—Ç–µ –∫–Ω–∏–≥–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∏ —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å</p>
                {% endif %}
                <a href="{{ url_for('books.book_list') }}" class="card-action btn-accent-green">
                    {% if recent_book %}–ß–∏—Ç–∞—Ç—å{% else %}–ù–∞–π—Ç–∏ –∫–Ω–∏–≥—É{% endif %} <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- QUICK ACTIONS - Full Width -->
            <div class="bento-card card-full accent-orange">
                <div class="card-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
                <div class="quick-links">
                    <a href="{{ url_for('study.cards', word_source='all') }}" class="quick-link">
                        <i class="fas fa-clone"></i>
                        <span>–ö–∞—Ä—Ç–æ—á–∫–∏</span>
                    </a>
                    <a href="{{ url_for('study.quiz', word_source='all') }}" class="quick-link">
                        <i class="fas fa-question-circle"></i>
                        <span>–¢–µ—Å—Ç</span>
                    </a>
                    <a href="{{ url_for('study.matching', word_source='all') }}" class="quick-link">
                        <i class="fas fa-th"></i>
                        <span>–ü–æ–¥–±–µ—Ä–∏ –ø–∞—Ä—É</span>
                    </a>
                    <a href="{{ url_for('grammar_lab.practice') }}" class="quick-link">
                        <i class="fas fa-dumbbell"></i>
                        <span>–ü—Ä–∞–∫—Ç–∏–∫–∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏</span>
                    </a>
                    <a href="{{ url_for('words.word_list') }}" class="quick-link">
                        <i class="fas fa-list"></i>
                        <span>–í—Å–µ —Å–ª–æ–≤–∞</span>
                    </a>
                    <a href="{{ url_for('study.topics') }}" class="quick-link">
                        <i class="fas fa-layer-group"></i>
                        <span>–¢–µ–º—ã —Å–ª–æ–≤</span>
                    </a>
                    <a href="{{ url_for('study.stats') }}" class="quick-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    </a>
                    <a href="{{ url_for('study.leaderboard') }}" class="quick-link">
                        <i class="fas fa-trophy"></i>
                        <span>–õ–∏–¥–µ—Ä—ã</span>
                    </a>
                </div>
            </div>

            <!-- ACHIEVEMENTS - Third -->
            <div class="bento-card card-third">
                <div class="card-icon bg-accent-orange">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="card-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                <div class="stat-number">{{ earned_achievements }}<span style="font-size: 0.4em; color: var(--dash-muted);">/{{ total_achievements }}</span></div>
                <div class="stat-label">–ø–æ–ª—É—á–µ–Ω–æ</div>
                <a href="{{ url_for('study.stats') }}" class="card-action" style="background: var(--dash-orange-soft); color: var(--dash-orange);">
                    –°–º–æ—Ç—Ä–µ—Ç—å <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- MATCHING GAME - Third -->
            <div class="bento-card card-third">
                <div class="card-icon" style="background: rgba(99, 102, 241, 0.15); color: #6366f1;">
                    <i class="fas fa-th"></i>
                </div>
                <div class="card-title">–ü–æ–¥–±–µ—Ä–∏ –ø–∞—Ä—É</div>
                {% if best_matching %}
                <div class="stat-number">{{ best_matching.score }}</div>
                <div class="stat-label">–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                {% else %}
                <div style="color: var(--dash-muted); margin-top: 0.5rem;">–ï—â—ë –Ω–µ –∏–≥—Ä–∞–ª–∏</div>
                {% endif %}
                <a href="{{ url_for('study.matching', word_source='all') }}" class="card-action" style="background: rgba(99, 102, 241, 0.15); color: #6366f1;">
                    –ò–≥—Ä–∞—Ç—å <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- QUIZ - Third -->
            <div class="bento-card card-third">
                <div class="card-icon" style="background: rgba(20, 184, 166, 0.15); color: #14b8a6;">
                    <i class="fas fa-question-circle"></i>
                </div>
                <div class="card-title">–¢–µ—Å—Ç</div>
                {% if best_quiz %}
                <div class="stat-number">{{ best_quiz.score }}%</div>
                <div class="stat-label">–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div>
                {% else %}
                <div style="color: var(--dash-muted); margin-top: 0.5rem;">–ï—â—ë –Ω–µ –∏–≥—Ä–∞–ª–∏</div>
                {% endif %}
                <a href="{{ url_for('study.quiz', word_source='all') }}" class="card-action" style="background: rgba(20, 184, 166, 0.15); color: #14b8a6;">
                    –ò–≥—Ä–∞—Ç—å <i class="fas fa-arrow-right"></i>
                </a>
            </div>

        </div>
    </div>
</div>
{% endblock %}
