{% extends 'base.html' %}

{% block title %}Dashboard - LLT English{% endblock %}

{% block styles %}
{{ super() }}
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
    --d-bg: #fafbfc;
    --d-surface: #ffffff;
    --d-border: #e8ecf0;
    --d-text: #1a1f36;
    --d-text-soft: #525f7f;
    --d-accent: #5046e5;
    --d-accent-soft: rgba(80, 70, 229, 0.08);
    --d-accent-medium: rgba(80, 70, 229, 0.15);
    --d-success: #10b981;
    --d-warning: #f59e0b;
    --d-radius: 16px;
    --d-radius-sm: 10px;
    --d-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.03);
    --d-shadow-hover: 0 4px 20px rgba(80, 70, 229, 0.12);
}

.dash {
    font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--d-bg);
    min-height: 100vh;
    padding: 2rem 0 4rem;
}

/* Header */
.dash-header {
    margin-bottom: 2rem;
}

.dash-greeting {
    font-size: 2rem;
    font-weight: 800;
    color: var(--d-text);
    margin: 0;
    letter-spacing: -0.03em;
}

.dash-subtitle {
    color: var(--d-text-soft);
    font-size: 1rem;
    margin-top: 0.5rem;
    font-weight: 500;
}

/* Module Grid - 2x2 */
.module-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
}

/* Universal Module Card */
.module-card {
    background: var(--d-surface);
    border: 1px solid var(--d-border);
    border-radius: var(--d-radius);
    padding: 1.5rem;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--d-shadow);
    display: flex;
    flex-direction: column;
}

.module-card:hover {
    border-color: var(--d-accent);
    box-shadow: var(--d-shadow-hover);
    transform: translateY(-2px);
}

/* Card Header - Icon + Title */
.module-header {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    margin-bottom: 1.25rem;
}

.module-icon {
    width: 44px;
    height: 44px;
    border-radius: var(--d-radius-sm);
    background: var(--d-accent-soft);
    color: var(--d-accent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.module-title {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--d-text-soft);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0;
}

/* Main Stat */
.module-stat {
    display: flex;
    align-items: baseline;
    gap: 0.25rem;
    margin-bottom: 0.25rem;
}

.module-stat-value {
    font-size: 2.75rem;
    font-weight: 800;
    color: var(--d-text);
    line-height: 1;
    letter-spacing: -0.03em;
}

.module-stat-total {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--d-text-soft);
}

.module-stat-label {
    font-size: 0.875rem;
    color: var(--d-text-soft);
    font-weight: 500;
    margin-bottom: 1rem;
}

/* Secondary Stats Row */
.module-stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.module-stats-row.cols-2 {
    grid-template-columns: repeat(2, 1fr);
}

.stat-box {
    background: var(--d-bg);
    border-radius: var(--d-radius-sm);
    padding: 0.75rem;
    text-align: center;
}

.stat-box-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--d-text);
    line-height: 1.2;
}

.stat-box-value.accent { color: var(--d-accent); }
.stat-box-value.success { color: var(--d-success); }
.stat-box-value.warning { color: var(--d-warning); }

.stat-box-label {
    font-size: 0.65rem;
    font-weight: 600;
    color: var(--d-text-soft);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.25rem;
}

/* Progress Bar */
.module-progress {
    height: 6px;
    background: var(--d-bg);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 1rem;
}

.module-progress-fill {
    height: 100%;
    background: var(--d-accent);
    border-radius: 3px;
    transition: width 0.5s ease;
}

/* Description */
.module-desc {
    color: var(--d-text-soft);
    font-size: 0.875rem;
    line-height: 1.5;
    margin-bottom: 1rem;
    flex-grow: 1;
}

/* Action Button - Unified */
.module-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.875rem 1.25rem;
    background: var(--d-accent);
    color: white;
    border-radius: var(--d-radius-sm);
    font-weight: 600;
    font-size: 0.9rem;
    text-decoration: none;
    transition: all 0.2s ease;
    margin-top: auto;
}

.module-action:hover {
    background: #4338ca;
    color: white;
    transform: scale(1.02);
}

.module-action i {
    font-size: 0.75rem;
    transition: transform 0.2s;
}

.module-action:hover i {
    transform: translateX(3px);
}

/* Quick Actions Section */
.quick-section {
    background: var(--d-surface);
    border: 1px solid var(--d-border);
    border-radius: var(--d-radius);
    padding: 1.5rem;
    box-shadow: var(--d-shadow);
    margin-bottom: 2rem;
}

.quick-title {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--d-text-soft);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0 0 1rem;
}

.quick-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
}

.quick-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.625rem;
    padding: 1rem;
    background: var(--d-bg);
    border: 1px solid var(--d-border);
    border-radius: var(--d-radius-sm);
    color: var(--d-text);
    font-size: 0.875rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
}

.quick-btn:hover {
    background: var(--d-accent-soft);
    border-color: var(--d-accent);
    color: var(--d-accent);
}

.quick-btn i {
    font-size: 1rem;
    opacity: 0.7;
}

/* Stats Row - Bottom */
.stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.stats-card {
    background: var(--d-surface);
    border: 1px solid var(--d-border);
    border-radius: var(--d-radius);
    padding: 1.25rem;
    box-shadow: var(--d-shadow);
    text-align: center;
    transition: all 0.2s;
}

.stats-card:hover {
    border-color: var(--d-accent);
}

.stats-card-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--d-radius-sm);
    background: var(--d-accent-soft);
    color: var(--d-accent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    margin: 0 auto 0.75rem;
}

.stats-card-value {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--d-text);
    line-height: 1;
}

.stats-card-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--d-text-soft);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.375rem;
}

.stats-card-action {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    margin-top: 0.75rem;
    color: var(--d-accent);
    font-size: 0.8rem;
    font-weight: 600;
    text-decoration: none;
}

.stats-card-action:hover {
    text-decoration: underline;
}

/* Responsive */
@media (max-width: 1024px) {
    .quick-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 768px) {
    .module-grid { grid-template-columns: 1fr; }
    .stats-row { grid-template-columns: 1fr; }
    .quick-grid { grid-template-columns: 1fr; }
    .dash-greeting { font-size: 1.5rem; }
    .module-stat-value { font-size: 2.25rem; }
}
</style>
{% endblock %}

{% block content %}
<div class="dash">
    <div class="container" style="max-width: 900px;">

        <!-- Header -->
        <div class="dash-header">
            <h1 class="dash-greeting">–ü—Ä–∏–≤–µ—Ç, {{ current_user.username }} üëã</h1>
            <p class="dash-subtitle">–í—ã–±–µ—Ä–∏, —á–µ–º —Ö–æ—á–µ—à—å –∑–∞–Ω—è—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è</p>
        </div>

        <!-- Main Module Grid -->
        <div class="module-grid">

            <!-- –ö–ê–†–¢–û–ß–ö–ò -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon"><i class="fas fa-clone"></i></div>
                    <h2 class="module-title">–ö–∞—Ä—Ç–æ—á–∫–∏</h2>
                </div>
                <div class="module-stat">
                    <span class="module-stat-value">{{ words_total }}</span>
                </div>
                <div class="module-stat-label">—Å–ª–æ–≤ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</div>
                <div class="module-stats-row">
                    <div class="stat-box">
                        <div class="stat-box-value warning">{{ words_stats.learning }}</div>
                        <div class="stat-box-label">–£—á—É</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-value accent">{{ words_stats.review }}</div>
                        <div class="stat-box-label">–ü–æ–≤—Ç–æ—Ä</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-value success">{{ words_stats.mastered }}</div>
                        <div class="stat-box-label">–í—ã—É—á–µ–Ω–æ</div>
                    </div>
                </div>
                {% if words_total > 0 %}
                <div class="module-progress">
                    <div class="module-progress-fill" style="width: {{ (words_stats.mastered / words_total * 100) | int }}%;"></div>
                </div>
                {% endif %}
                <a href="{{ url_for('study.index') }}" class="module-action">
                    –£—á–∏—Ç—å —Å–ª–æ–≤–∞ <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- –ì–†–ê–ú–ú–ê–¢–ò–ö–ê -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon"><i class="fas fa-flask"></i></div>
                    <h2 class="module-title">–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</h2>
                </div>
                <div class="module-stat">
                    <span class="module-stat-value">{{ grammar_studied }}</span>
                    <span class="module-stat-total">/ {{ grammar_total }}</span>
                </div>
                <div class="module-stat-label">—Ç–µ–º –∏–∑—É—á–µ–Ω–æ</div>
                <div class="module-stats-row cols-2">
                    <div class="stat-box">
                        <div class="stat-box-value success">{{ grammar_mastered }}</div>
                        <div class="stat-box-label">–û—Å–≤–æ–µ–Ω–æ</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-value">{{ grammar_total - grammar_studied }}</div>
                        <div class="stat-box-label">–û—Å—Ç–∞–ª–æ—Å—å</div>
                    </div>
                </div>
                <a href="{{ url_for('grammar_lab.index') }}" class="module-action">
                    Grammar Lab <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- –ö–£–†–°–´ -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon"><i class="fas fa-graduation-cap"></i></div>
                    <h2 class="module-title">–ö—É—Ä—Å—ã</h2>
                </div>
                {% if active_course %}
                <div class="module-stat">
                    <span class="module-stat-value">{{ active_course.progress_percentage | int }}%</span>
                </div>
                <div class="module-stat-label">{{ active_course.course.title }}</div>
                <div class="module-progress">
                    <div class="module-progress-fill" style="width: {{ active_course.progress_percentage | int }}%;"></div>
                </div>
                {% else %}
                <div class="module-stat">
                    <span class="module-stat-value">{{ courses_enrolled }}</span>
                </div>
                <div class="module-stat-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</div>
                <p class="module-desc">–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å –∏ –Ω–∞—á–Ω–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ</p>
                {% endif %}
                <a href="{{ url_for('book_courses.list_book_courses') }}" class="module-action">
                    {% if active_course %}–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å{% else %}–í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å{% endif %} <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            <!-- –ö–ù–ò–ì–ò -->
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon"><i class="fas fa-book-open"></i></div>
                    <h2 class="module-title">–ö–Ω–∏–≥–∏</h2>
                </div>
                {% if recent_book %}
                <div class="module-stat">
                    <span class="module-stat-value">{{ books_reading }}</span>
                </div>
                <div class="module-stat-label">{{ recent_book.chapter.book.title }}</div>
                {% else %}
                <div class="module-stat">
                    <span class="module-stat-value">{{ books_reading }}</span>
                </div>
                <div class="module-stat-label">–∫–Ω–∏–≥ —á–∏—Ç–∞–µ—Ç–µ</div>
                <p class="module-desc">–ß–∏—Ç–∞–π—Ç–µ –∫–Ω–∏–≥–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –∏ —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å</p>
                {% endif %}
                <a href="{{ url_for('books.book_list') }}" class="module-action">
                    {% if recent_book %}–ß–∏—Ç–∞—Ç—å{% else %}–ù–∞–π—Ç–∏ –∫–Ω–∏–≥—É{% endif %} <i class="fas fa-arrow-right"></i>
                </a>
            </div>

        </div>

        <!-- Telegram Banner -->
        {% include 'partials/telegram_banner.html' %}

        <!-- Quick Actions -->
        <div class="quick-section">
            <h3 class="quick-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
            <div class="quick-grid">
                <a href="{{ url_for('study.cards', word_source='all') }}" class="quick-btn">
                    <i class="fas fa-clone"></i> –ö–∞—Ä—Ç–æ—á–∫–∏
                </a>
                <a href="{{ url_for('study.quiz', word_source='all') }}" class="quick-btn">
                    <i class="fas fa-question-circle"></i> –¢–µ—Å—Ç
                </a>
                <a href="{{ url_for('study.matching', word_source='all') }}" class="quick-btn">
                    <i class="fas fa-th"></i> –ü–æ–¥–±–µ—Ä–∏ –ø–∞—Ä—É
                </a>
                <a href="{{ url_for('grammar_lab.practice') }}" class="quick-btn">
                    <i class="fas fa-dumbbell"></i> –ü—Ä–∞–∫—Ç–∏–∫–∞
                </a>
                <a href="{{ url_for('words.word_list') }}" class="quick-btn">
                    <i class="fas fa-list"></i> –í—Å–µ —Å–ª–æ–≤–∞
                </a>
                <a href="{{ url_for('study.topics') }}" class="quick-btn">
                    <i class="fas fa-layer-group"></i> –¢–µ–º—ã
                </a>
                <a href="{{ url_for('study.stats') }}" class="quick-btn">
                    <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </a>
                <a href="{{ url_for('study.leaderboard') }}" class="quick-btn">
                    <i class="fas fa-trophy"></i> –õ–∏–¥–µ—Ä—ã
                </a>
            </div>
        </div>

        <!-- Bottom Stats -->
        <div class="stats-row">
            <div class="stats-card">
                <div class="stats-card-icon"><i class="fas fa-trophy"></i></div>
                <div class="stats-card-value">{{ earned_achievements }}<span style="font-size: 0.5em; color: var(--d-text-soft);">/{{ total_achievements }}</span></div>
                <div class="stats-card-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                <a href="{{ url_for('study.stats') }}" class="stats-card-action">
                    –°–º–æ—Ç—Ä–µ—Ç—å <i class="fas fa-chevron-right" style="font-size: 0.65rem;"></i>
                </a>
            </div>
            <div class="stats-card">
                <div class="stats-card-icon"><i class="fas fa-th"></i></div>
                {% if best_matching %}
                <div class="stats-card-value">{{ best_matching.score }}</div>
                {% else %}
                <div class="stats-card-value">‚Äî</div>
                {% endif %}
                <div class="stats-card-label">–õ—É—á—à–∏–π –º–∞—Ç—á</div>
                <a href="{{ url_for('study.matching', word_source='all') }}" class="stats-card-action">
                    –ò–≥—Ä–∞—Ç—å <i class="fas fa-chevron-right" style="font-size: 0.65rem;"></i>
                </a>
            </div>
            <div class="stats-card">
                <div class="stats-card-icon"><i class="fas fa-question-circle"></i></div>
                {% if best_quiz %}
                <div class="stats-card-value">{{ best_quiz.score }}%</div>
                {% else %}
                <div class="stats-card-value">‚Äî</div>
                {% endif %}
                <div class="stats-card-label">–õ—É—á—à–∏–π —Ç–µ—Å—Ç</div>
                <a href="{{ url_for('study.quiz', word_source='all') }}" class="stats-card-action">
                    –ò–≥—Ä–∞—Ç—å <i class="fas fa-chevron-right" style="font-size: 0.65rem;"></i>
                </a>
            </div>
        </div>

    </div>
</div>
{% endblock %}
