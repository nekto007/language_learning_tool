{% extends 'base.html' %}

{% block title %}Dashboard - LLT English{% endblock %}

{% block content %}
<div class="dash-page">

    <!-- Hero: Greeting + Streak -->
    <div class="dash-hero">
        <div class="dash-hero__bg-shapes">
            <div class="dash-shape dash-shape--1"></div>
            <div class="dash-shape dash-shape--2"></div>
        </div>
        <div class="dash-hero__content">
            <div class="dash-hero__greeting">
                <span class="dash-hero__wave">&#128075;</span>
                <div>
                    <h1 class="dash-hero__title">&#1055;&#1088;&#1080;&#1074;&#1077;&#1090;, {{ current_user.username }}!</h1>
                    {% if streak > 0 %}
                    <div class="dash-streak">
                        <span class="dash-streak__fire">&#128293;</span>
                        <span class="dash-streak__text">{{ streak }}
                            {% if streak == 1 %}&#1076;&#1077;&#1085;&#1100;{% elif streak < 5 %}&#1076;&#1085;&#1103;{% else %}&#1076;&#1085;&#1077;&#1081;{% endif %} &#1087;&#1086;&#1076;&#1088;&#1103;&#1076;</span>
                    </div>
                    {% else %}
                    <p class="dash-hero__subtitle">&#1042;&#1099;&#1073;&#1077;&#1088;&#1080;, &#1095;&#1077;&#1084; &#1093;&#1086;&#1095;&#1077;&#1096;&#1100; &#1079;&#1072;&#1085;&#1103;&#1090;&#1100;&#1089;&#1103; &#1089;&#1077;&#1075;&#1086;&#1076;&#1085;&#1103;</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Plan -->
    <div class="dash-plan">
        <h2 class="dash-plan__heading">&#1055;&#1083;&#1072;&#1085; &#1085;&#1072; &#1089;&#1077;&#1075;&#1086;&#1076;&#1085;&#1103;</h2>

        {% set ns = namespace(step=1) %}

        {# Step: Next Lesson #}
        {% if daily_plan.next_lesson %}
        <div class="dash-step dash-step--lesson {% if plan_completion.lesson %}dash-step--completed{% endif %}" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">{% if plan_completion.lesson %}&#10003;{% else %}{{ ns.step }}{% endif %}</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#127919;</div>
                <div class="dash-step__info">
                    <div class="dash-step__title">&#1052;&#1086;&#1076;&#1091;&#1083;&#1100; {{ daily_plan.next_lesson.module_number }} &mdash; {{ daily_plan.next_lesson.title }}</div>
                    <div class="dash-step__meta">~{{ lesson_minutes }} &#1084;&#1080;&#1085;</div>
                </div>
                {% if plan_completion.lesson %}
                <span class="dash-step__btn">&#1043;&#1086;&#1090;&#1086;&#1074;&#1086; &#10003;</span>
                {% else %}
                <a href="{{ url_for('curriculum_lessons.lesson_detail', lesson_id=daily_plan.next_lesson.lesson_id) }}?from=daily_plan" class="dash-step__btn">&#1053;&#1072;&#1095;&#1072;&#1090;&#1100;</a>
                {% endif %}
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}

        {% elif daily_plan.onboarding and daily_plan.onboarding.first_lesson %}
        <div class="dash-step dash-step--lesson" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">{{ ns.step }}</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#127919;</div>
                <div class="dash-step__info">
                    <div class="dash-step__title">{{ daily_plan.onboarding.first_lesson.level_code }} / &#1052;&#1086;&#1076;&#1091;&#1083;&#1100; {{ daily_plan.onboarding.first_lesson.module_number }}: {{ daily_plan.onboarding.first_lesson.module_title }}</div>
                    <div class="dash-step__meta">~{{ daily_plan.onboarding.first_lesson.estimated_minutes }} &#1084;&#1080;&#1085; &middot; &#1055;&#1077;&#1088;&#1074;&#1099;&#1081; &#1091;&#1088;&#1086;&#1082;</div>
                </div>
                <a href="{{ url_for('learn.learn_index') }}" class="dash-step__btn">&#1053;&#1072;&#1095;&#1072;&#1090;&#1100;</a>
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}
        {% endif %}

        {# Step: Grammar #}
        {% if daily_plan.grammar_topic %}
        <div class="dash-step dash-step--grammar {% if plan_completion.grammar %}dash-step--completed{% endif %}" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">{% if plan_completion.grammar %}&#10003;{% else %}{{ ns.step }}{% endif %}</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#129504;</div>
                <div class="dash-step__info">
                    <div class="dash-step__title">Grammar Lab &mdash; {{ daily_plan.grammar_topic.title }}</div>
                    <div class="dash-step__meta">3&ndash;5 &#1084;&#1080;&#1085;
                        {% if daily_plan.grammar_topic.due_exercises > 0 %}
                        &middot; {{ daily_plan.grammar_topic.due_exercises }} &#1091;&#1087;&#1088;&#1072;&#1078;&#1085;&#1077;&#1085;&#1080;&#1081; &#1085;&#1072; &#1087;&#1086;&#1074;&#1090;&#1086;&#1088;
                        {% endif %}
                    </div>
                </div>
                {% if plan_completion.grammar %}
                <span class="dash-step__btn">&#1043;&#1086;&#1090;&#1086;&#1074;&#1086; &#10003;</span>
                {% elif daily_plan.grammar_topic.status == 'not_started' %}
                <a href="{{ url_for('grammar_lab.topic_detail', topic_id=daily_plan.grammar_topic.topic_id) }}?from=daily_plan" class="dash-step__btn">&#1058;&#1077;&#1086;&#1088;&#1080;&#1103;</a>
                {% else %}
                <a href="{{ url_for('grammar_lab.practice', topic_id=daily_plan.grammar_topic.topic_id) }}?from=daily_plan" class="dash-step__btn">&#1055;&#1088;&#1072;&#1082;&#1090;&#1080;&#1082;&#1072;</a>
                {% endif %}
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}
        {% endif %}

        {# Step: Words #}
        {% if daily_plan.words_due > 0 or daily_plan.has_any_words or (daily_plan.onboarding and daily_plan.onboarding.get('no_words')) %}
        <div class="dash-step dash-step--words {% if plan_completion.words %}dash-step--completed{% endif %}" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">{% if plan_completion.words %}&#10003;{% else %}{{ ns.step }}{% endif %}</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#128214;</div>
                <div class="dash-step__info">
                    {% if plan_completion.words %}
                    <div class="dash-step__title">&#1042;&#1089;&#1105; &#1087;&#1086;&#1074;&#1090;&#1086;&#1088;&#1077;&#1085;&#1086;! &#10003;</div>
                    <div class="dash-step__meta">&#1047;&#1072;&#1074;&#1090;&#1088;&#1072; &#1073;&#1091;&#1076;&#1091;&#1090; &#1085;&#1086;&#1074;&#1099;&#1077;</div>
                    {% elif daily_plan.words_due > 0 %}
                    <div class="dash-step__title">{{ daily_plan.words_due }} &#1089;&#1083;&#1086;&#1074; &#1085;&#1072; &#1087;&#1086;&#1074;&#1090;&#1086;&#1088;</div>
                    <div class="dash-step__meta">~{{ words_minutes }} &#1084;&#1080;&#1085;</div>
                    {% elif daily_plan.has_any_words %}
                    <div class="dash-step__title">&#1042;&#1089;&#1105; &#1087;&#1086;&#1074;&#1090;&#1086;&#1088;&#1077;&#1085;&#1086;! &#10003;</div>
                    <div class="dash-step__meta">&#1047;&#1072;&#1074;&#1090;&#1088;&#1072; &#1073;&#1091;&#1076;&#1091;&#1090; &#1085;&#1086;&#1074;&#1099;&#1077;</div>
                    {% else %}
                    <div class="dash-step__title">&#1044;&#1086;&#1073;&#1072;&#1074;&#1100; &#1089;&#1083;&#1086;&#1074;&#1072;</div>
                    <div class="dash-step__meta">&#1057;&#1086;&#1079;&#1076;&#1072;&#1081; &#1082;&#1086;&#1083;&#1086;&#1076;&#1091; &#1080; &#1076;&#1086;&#1073;&#1072;&#1074;&#1100; 5&ndash;10 &#1089;&#1083;&#1086;&#1074;</div>
                    {% endif %}
                </div>
                {% if plan_completion.words %}
                <span class="dash-step__btn">&#1043;&#1086;&#1090;&#1086;&#1074;&#1086; &#10003;</span>
                {% elif daily_plan.words_due > 0 %}
                <a href="{{ cards_url }}?from=daily_plan" class="dash-step__btn">&#1055;&#1086;&#1074;&#1090;&#1086;&#1088;&#1080;&#1090;&#1100;</a>
                {% elif not daily_plan.has_any_words %}
                <a href="{{ url_for('words.word_list') }}" class="dash-step__btn">&#1057;&#1083;&#1086;&#1074;&#1072;</a>
                {% endif %}
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}
        {% endif %}

        {# Step: Reading #}
        {% if daily_plan.book_to_read %}
        <div class="dash-step dash-step--book {% if plan_completion.books %}dash-step--completed{% endif %}" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">{% if plan_completion.books %}&#10003;{% else %}{{ ns.step }}{% endif %}</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#128213;</div>
                <div class="dash-step__info">
                    <div class="dash-step__title">{{ daily_plan.book_to_read.title }}</div>
                    <div class="dash-step__meta">5&ndash;10 &#1084;&#1080;&#1085; &#1095;&#1090;&#1077;&#1085;&#1080;&#1103;</div>
                </div>
                {% if plan_completion.books %}
                <span class="dash-step__btn">&#1043;&#1086;&#1090;&#1086;&#1074;&#1086; &#10003;</span>
                {% else %}
                <a href="{{ url_for('books.read_book_chapters', book_id=daily_plan.book_to_read.id) }}?from=daily_plan" class="dash-step__btn">&#1063;&#1080;&#1090;&#1072;&#1090;&#1100;</a>
                {% endif %}
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}

        {% elif daily_plan.suggested_books %}
        <div class="dash-step dash-step--book" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">{{ ns.step }}</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#128213;</div>
                <div class="dash-step__info">
                    <div class="dash-step__title">&#1042;&#1099;&#1073;&#1077;&#1088;&#1080; &#1082;&#1085;&#1080;&#1075;&#1091;</div>
                    <div class="dash-step__books-list">
                        {% for book in daily_plan.suggested_books %}
                        <a href="{{ url_for('books.book_details', book_id=book.id) }}" class="dash-step__book-link">{{ book.title }}</a>
                        {% endfor %}
                    </div>
                </div>
                <a href="{{ url_for('books.book_list') }}" class="dash-step__btn">&#1050;&#1085;&#1080;&#1075;&#1080;</a>
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}

        {% elif daily_plan.onboarding and daily_plan.onboarding.get('available_books') %}
        <div class="dash-step dash-step--book" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">{{ ns.step }}</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#128213;</div>
                <div class="dash-step__info">
                    <div class="dash-step__title">&#1042;&#1099;&#1073;&#1077;&#1088;&#1080; &#1082;&#1085;&#1080;&#1075;&#1091;</div>
                    <div class="dash-step__books-list">
                        {% for book in daily_plan.onboarding.available_books[:3] %}
                        <a href="{{ url_for('books.book_details', book_id=book.id) }}" class="dash-step__book-link">{{ book.title }}</a>
                        {% endfor %}
                    </div>
                </div>
                <a href="{{ url_for('books.book_list') }}" class="dash-step__btn">&#1050;&#1085;&#1080;&#1075;&#1080;</a>
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}
        {% endif %}

        {# Bonus step: shown when >=2 main tasks are done #}
        {% set done = [plan_completion.lesson, plan_completion.grammar, plan_completion.words, plan_completion.books] | select | list | length %}
        {% if done >= 2 and daily_plan.bonus and (daily_plan.bonus.extra_lesson or daily_plan.bonus.extra_reading) %}
        <div class="dash-step dash-step--bonus" style="animation-delay: {{ ns.step * 0.08 }}s">
            <div class="dash-step__num">&#11088;</div>
            <div class="dash-step__body">
                <div class="dash-step__icon">&#128640;</div>
                <div class="dash-step__info">
                    {% if daily_plan.bonus.extra_lesson %}
                    <div class="dash-step__title">&#1041;&#1086;&#1085;&#1091;&#1089;: &#1052;&#1086;&#1076;&#1091;&#1083;&#1100; {{ daily_plan.bonus.extra_lesson.module_number }} &mdash; {{ daily_plan.bonus.extra_lesson.title }}</div>
                    <div class="dash-step__meta">&#1044;&#1086;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1099;&#1081; &#1091;&#1088;&#1086;&#1082;</div>
                    {% elif daily_plan.bonus.extra_reading %}
                    <div class="dash-step__title">&#1041;&#1086;&#1085;&#1091;&#1089;: &#1055;&#1086;&#1095;&#1080;&#1090;&#1072;&#1081; &#1077;&#1097;&#1105;</div>
                    <div class="dash-step__meta">&#1044;&#1086;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1077;&#1083;&#1100;&#1085;&#1086;&#1077; &#1095;&#1090;&#1077;&#1085;&#1080;&#1077;</div>
                    {% endif %}
                </div>
                {% if daily_plan.bonus.extra_lesson %}
                <a href="{{ url_for('curriculum_lessons.lesson_detail', lesson_id=daily_plan.bonus.extra_lesson.lesson_id) }}?from=daily_plan" class="dash-step__btn">&#1053;&#1072;&#1095;&#1072;&#1090;&#1100;</a>
                {% elif daily_plan.bonus.extra_reading and daily_plan.book_to_read %}
                <a href="{{ url_for('books.read_book_chapters', book_id=daily_plan.book_to_read.id) }}?from=daily_plan" class="dash-step__btn">&#1063;&#1080;&#1090;&#1072;&#1090;&#1100;</a>
                {% else %}
                <a href="{{ url_for('books.book_list') }}?from=daily_plan" class="dash-step__btn">&#1050;&#1085;&#1080;&#1075;&#1080;</a>
                {% endif %}
            </div>
        </div>
        {% set ns.step = ns.step + 1 %}
        {% endif %}

        {% if ns.step == 1 %}
        <div class="dash-step dash-step--done">
            <div class="dash-step__body">
                <div class="dash-step__icon">&#10024;</div>
                <div class="dash-step__info">
                    <div class="dash-step__title">&#1042;&#1089;&#1105; &#1085;&#1072; &#1089;&#1077;&#1075;&#1086;&#1076;&#1085;&#1103; &#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086;!</div>
                    <div class="dash-step__meta">&#1055;&#1088;&#1086;&#1076;&#1086;&#1083;&#1078;&#1072;&#1081; &#1079;&#1072;&#1074;&#1090;&#1088;&#1072;</div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Today's Summary -->
    {% if daily_summary.lessons_count > 0 or daily_summary.grammar_exercises > 0 or daily_summary.words_reviewed > 0 or daily_summary.books_read %}
    <div class="dash-summary">
        <h3 class="dash-summary__heading">&#1057;&#1077;&#1075;&#1086;&#1076;&#1085;&#1103; &#1089;&#1076;&#1077;&#1083;&#1072;&#1085;&#1086;</h3>
        <div class="dash-summary__grid">
            {% if daily_summary.lessons_count > 0 %}
            <div class="dash-summary__item">
                <div class="dash-summary__value">{{ daily_summary.lessons_count }}</div>
                <div class="dash-summary__label">&#1091;&#1088;&#1086;&#1082;&#1086;&#1074;</div>
            </div>
            {% endif %}
            {% if daily_summary.grammar_exercises > 0 %}
            <div class="dash-summary__item">
                <div class="dash-summary__value">{{ daily_summary.grammar_correct }}/{{ daily_summary.grammar_exercises }}</div>
                <div class="dash-summary__label">&#1075;&#1088;&#1072;&#1084;&#1084;&#1072;&#1090;&#1080;&#1082;&#1072;</div>
            </div>
            {% endif %}
            {% if daily_summary.words_reviewed > 0 %}
            <div class="dash-summary__item">
                <div class="dash-summary__value">{{ daily_summary.words_reviewed }}</div>
                <div class="dash-summary__label">&#1089;&#1083;&#1086;&#1074;</div>
            </div>
            {% endif %}
            {% if daily_summary.books_read %}
            <div class="dash-summary__item">
                <div class="dash-summary__value">{{ daily_summary.books_read | length }}</div>
                <div class="dash-summary__label">&#1082;&#1085;&#1080;&#1075;</div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Telegram Banner -->
    {% include 'partials/telegram_banner.html' %}

    <!-- Progress Overview -->
    <div class="dash-progress">
        <h3 class="dash-progress__heading">&#1052;&#1086;&#1081; &#1087;&#1088;&#1086;&#1075;&#1088;&#1077;&#1089;&#1089;</h3>
        <div class="dash-progress__grid">
            <a href="{{ url_for('study.index') }}" class="dash-progress__card dash-progress__card--words">
                <div class="dash-progress__emoji">&#127183;</div>
                <div class="dash-progress__data">
                    <div class="dash-progress__value">{{ words_total }}</div>
                    <div class="dash-progress__label">&#1089;&#1083;&#1086;&#1074; &#1074; &#1082;&#1086;&#1083;&#1083;&#1077;&#1082;&#1094;&#1080;&#1080;</div>
                </div>
                <div class="dash-progress__arrow">&rsaquo;</div>
            </a>
            <a href="{{ url_for('grammar_lab.index') }}" class="dash-progress__card dash-progress__card--grammar">
                <div class="dash-progress__emoji">&#129504;</div>
                <div class="dash-progress__data">
                    <div class="dash-progress__value">{{ grammar_studied }}<span class="dash-progress__total">/{{ grammar_total }}</span></div>
                    <div class="dash-progress__label">&#1090;&#1077;&#1084; &#1075;&#1088;&#1072;&#1084;&#1084;&#1072;&#1090;&#1080;&#1082;&#1080;</div>
                </div>
                <div class="dash-progress__arrow">&rsaquo;</div>
            </a>
            <a href="{{ url_for('book_courses.list_book_courses') }}" class="dash-progress__card dash-progress__card--courses">
                <div class="dash-progress__emoji">&#127891;</div>
                <div class="dash-progress__data">
                    <div class="dash-progress__value">{% if active_course %}{{ active_course.progress_percentage | int }}%{% else %}{{ courses_enrolled }}{% endif %}</div>
                    <div class="dash-progress__label">{% if active_course %}{{ active_course.course.title }}{% else %}&#1072;&#1082;&#1090;&#1080;&#1074;&#1085;&#1099;&#1093; &#1082;&#1091;&#1088;&#1089;&#1086;&#1074;{% endif %}</div>
                </div>
                <div class="dash-progress__arrow">&rsaquo;</div>
            </a>
            <a href="{{ url_for('books.book_list') }}" class="dash-progress__card dash-progress__card--books">
                <div class="dash-progress__emoji">&#128218;</div>
                <div class="dash-progress__data">
                    <div class="dash-progress__value">{{ books_reading }}</div>
                    <div class="dash-progress__label">{% if books_reading == 1 %}&#1082;&#1085;&#1080;&#1075;&#1072;{% elif books_reading < 5 %}&#1082;&#1085;&#1080;&#1075;&#1080;{% else %}&#1082;&#1085;&#1080;&#1075;{% endif %} &#1095;&#1080;&#1090;&#1072;&#1102;</div>
                </div>
                <div class="dash-progress__arrow">&rsaquo;</div>
            </a>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="dash-quick">
        <h3 class="dash-quick__title">&#1041;&#1099;&#1089;&#1090;&#1088;&#1099;&#1077; &#1076;&#1077;&#1081;&#1089;&#1090;&#1074;&#1080;&#1103;</h3>
        <div class="dash-quick__grid">
            <a href="{{ url_for('study.cards', word_source='all') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#127183;</span>&#1050;&#1072;&#1088;&#1090;&#1086;&#1095;&#1082;&#1080;</a>
            <a href="{{ url_for('study.quiz', word_source='all') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#10067;</span>&#1058;&#1077;&#1089;&#1090;</a>
            <a href="{{ url_for('study.matching', word_source='all') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#129513;</span>&#1055;&#1086;&#1076;&#1073;&#1077;&#1088;&#1080; &#1087;&#1072;&#1088;&#1091;</a>
            <a href="{{ url_for('grammar_lab.practice') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#9999;&#65039;</span>&#1055;&#1088;&#1072;&#1082;&#1090;&#1080;&#1082;&#1072;</a>
            <a href="{{ url_for('words.word_list') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#128209;</span>&#1042;&#1089;&#1077; &#1089;&#1083;&#1086;&#1074;&#1072;</a>
            <a href="{{ url_for('study.topics') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#128194;</span>&#1058;&#1077;&#1084;&#1099;</a>
            <a href="{{ url_for('study.stats') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#128200;</span>&#1057;&#1090;&#1072;&#1090;&#1080;&#1089;&#1090;&#1080;&#1082;&#1072;</a>
            <a href="{{ url_for('study.leaderboard') }}" class="dash-quick__btn"><span class="dash-quick__ico">&#127942;</span>&#1051;&#1080;&#1076;&#1077;&#1088;&#1099;</a>
        </div>
    </div>

</div>

<style>
/* ============================================
   Dashboard Page
   ============================================ */

@import url('https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700;800&display=swap');

.dash-page {
    --dash-font: 'Onest', -apple-system, BlinkMacSystemFont, sans-serif;
    --dash-bg: #fafbfc;
    --dash-surface: #ffffff;
    --dash-surface-alt: #f8fafc;
    --dash-border: #e2e8f0;
    --dash-text: #0f172a;
    --dash-text-muted: #64748b;
    --dash-accent: #5046e5;
    --dash-accent-soft: rgba(80, 70, 229, 0.08);
    --dash-accent-medium: rgba(80, 70, 229, 0.15);
    --dash-success: #10b981;
    --dash-warning: #f59e0b;
    --dash-radius: 16px;
    --dash-radius-sm: 10px;
    --dash-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 12px rgba(0, 0, 0, 0.03);
    --dash-shadow-hover: 0 4px 20px rgba(80, 70, 229, 0.12);

    font-family: var(--dash-font);
    max-width: 900px;
    margin: 0 auto;
    padding: 0 1rem 3rem;
}

/* ============================================
   Hero Section
   ============================================ */

.dash-hero {
    position: relative;
    background: linear-gradient(135deg, #5046e5 0%, #7c3aed 100%);
    border-radius: var(--dash-radius);
    padding: 2rem;
    margin-bottom: 1.5rem;
    overflow: hidden;
    color: white;
    animation: dashSlideUp 0.5s ease-out;
}

.dash-hero__bg-shapes { position: absolute; inset: 0; overflow: hidden; pointer-events: none; }
.dash-shape { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.1); }
.dash-shape--1 { width: 250px; height: 250px; top: -80px; right: -40px; animation: dashFloat1 20s ease-in-out infinite; }
.dash-shape--2 { width: 150px; height: 150px; bottom: -50px; left: -30px; animation: dashFloat2 15s ease-in-out infinite; }

@keyframes dashFloat1 { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(-20px, 20px) scale(1.05); } }
@keyframes dashFloat2 { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 50% { transform: translate(30px, -20px) rotate(10deg); } }

.dash-hero__content { position: relative; z-index: 1; }

.dash-hero__greeting {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.dash-hero__wave { font-size: 2.5rem; animation: dashWave 2s ease-in-out infinite; transform-origin: 70% 70%; }

@keyframes dashWave {
    0%, 100% { transform: rotate(0deg); }
    10%, 30% { transform: rotate(14deg); }
    20% { transform: rotate(-8deg); }
    40% { transform: rotate(0deg); }
}

.dash-hero__title { font-size: 1.5rem; font-weight: 700; margin: 0; line-height: 1.2; letter-spacing: -0.02em; }
.dash-hero__subtitle { font-size: 0.9375rem; margin: 0.25rem 0 0; opacity: 0.9; }

.dash-streak {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    margin-top: 0.5rem;
    padding: 0.375rem 0.875rem;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 100px;
    font-size: 0.9375rem;
    font-weight: 600;
    backdrop-filter: blur(5px);
}

.dash-streak__fire { font-size: 1.125rem; }

/* ============================================
   Daily Plan
   ============================================ */

.dash-plan {
    margin-bottom: 1.5rem;
    animation: dashSlideUp 0.45s ease-out both;
    animation-delay: 0.05s;
}

.dash-plan__heading {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--dash-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0 0 0.75rem;
}

.dash-step {
    display: flex;
    align-items: stretch;
    margin-bottom: 0.75rem;
    animation: dashSlideUp 0.4s ease-out both;
}

.dash-step__num {
    width: 32px;
    min-width: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8125rem;
    font-weight: 700;
    color: var(--dash-text-muted);
    padding-top: 1rem;
}

.dash-step__body {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: var(--dash-surface);
    border: 1px solid var(--dash-border);
    border-radius: var(--dash-radius-sm);
    box-shadow: var(--dash-shadow);
    transition: all 0.2s;
}

.dash-step--lesson .dash-step__body { border-left: 3px solid #5046e5; }
.dash-step--grammar .dash-step__body { border-left: 3px solid #06b6d4; }
.dash-step--words .dash-step__body { border-left: 3px solid #f59e0b; }
.dash-step--book .dash-step__body { border-left: 3px solid #10b981; }
.dash-step--done .dash-step__body { border-left: 3px solid #94a3b8; }
.dash-step--bonus .dash-step__body { border-left: 3px solid #f97316; }

/* Completed step */
.dash-step--completed .dash-step__body {
    opacity: 0.6;
    border-left-color: #10b981 !important;
}
.dash-step--completed .dash-step__num {
    background: #10b981;
    color: white;
    border-radius: 50%;
    font-size: 0.75rem;
}
.dash-step--completed .dash-step__btn {
    background: #10b981;
    pointer-events: none;
}

.dash-step__body:hover {
    border-color: var(--dash-accent);
    box-shadow: var(--dash-shadow-hover);
}

.dash-step__icon { font-size: 1.5rem; flex-shrink: 0; }

.dash-step__info { flex: 1; min-width: 0; }

.dash-step__title {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--dash-text);
    line-height: 1.3;
}

.dash-step__meta {
    font-size: 0.8125rem;
    color: var(--dash-text-muted);
    margin-top: 0.125rem;
}

.dash-step__btn {
    flex-shrink: 0;
    padding: 0.5rem 1.25rem;
    background: var(--dash-accent);
    color: white;
    border-radius: var(--dash-radius-sm);
    font-weight: 600;
    font-size: 0.875rem;
    text-decoration: none;
    transition: all 0.2s;
    white-space: nowrap;
}

.dash-step__btn:hover {
    background: #4338ca;
    color: white;
    transform: scale(1.03);
}

.dash-step__books-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    margin-top: 0.375rem;
}

.dash-step__book-link {
    font-size: 0.8125rem;
    color: var(--dash-accent);
    text-decoration: none;
    padding: 0.125rem 0.5rem;
    background: var(--dash-accent-soft);
    border-radius: 6px;
    transition: background 0.2s;
}

.dash-step__book-link:hover {
    background: var(--dash-accent-medium);
}

/* ============================================
   Today Summary
   ============================================ */

.dash-summary {
    background: var(--dash-surface);
    border: 1px solid var(--dash-border);
    border-radius: var(--dash-radius);
    padding: 1.25rem 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--dash-shadow);
    animation: dashSlideUp 0.45s ease-out both;
    animation-delay: 0.15s;
}

.dash-summary__heading {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--dash-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0 0 0.75rem;
}

.dash-summary__grid {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
}

.dash-summary__item { text-align: center; }

.dash-summary__value {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--dash-text);
    line-height: 1;
}

.dash-summary__label {
    font-size: 0.6875rem;
    font-weight: 600;
    color: var(--dash-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.25rem;
}

/* ============================================
   Progress Overview
   ============================================ */

.dash-progress {
    margin-bottom: 1.5rem;
    animation: dashSlideUp 0.45s ease-out both;
    animation-delay: 0.2s;
}

.dash-progress__heading {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--dash-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0 0 0.75rem;
}

.dash-progress__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
}

.dash-progress__card {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    padding: 1rem 1.125rem;
    background: var(--dash-surface);
    border: 1px solid var(--dash-border);
    border-radius: var(--dash-radius-sm);
    box-shadow: var(--dash-shadow);
    text-decoration: none;
    transition: all 0.2s;
    border-left: 3px solid transparent;
}

.dash-progress__card--words { border-left-color: #f59e0b; }
.dash-progress__card--grammar { border-left-color: #06b6d4; }
.dash-progress__card--courses { border-left-color: #5046e5; }
.dash-progress__card--books { border-left-color: #10b981; }

.dash-progress__card:hover {
    border-color: var(--dash-accent);
    box-shadow: var(--dash-shadow-hover);
    transform: translateY(-1px);
}

.dash-progress__emoji {
    font-size: 1.5rem;
    flex-shrink: 0;
    line-height: 1;
}

.dash-progress__data {
    flex: 1;
    min-width: 0;
}

.dash-progress__value {
    font-size: 1.375rem;
    font-weight: 800;
    color: var(--dash-text);
    line-height: 1;
    letter-spacing: -0.03em;
}

.dash-progress__total {
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--dash-text-muted);
}

.dash-progress__label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--dash-text-muted);
    margin-top: 0.125rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.dash-progress__arrow {
    font-size: 1.25rem;
    color: var(--dash-border);
    font-weight: 300;
    flex-shrink: 0;
    transition: all 0.2s;
}

.dash-progress__card:hover .dash-progress__arrow {
    color: var(--dash-accent);
    transform: translateX(2px);
}

/* ============================================
   Quick Actions
   ============================================ */

.dash-quick {
    animation: dashSlideUp 0.5s ease-out both;
    animation-delay: 0.3s;
    margin-bottom: 1.5rem;
}

.dash-quick__title {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--dash-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0 0 0.75rem;
}

.dash-quick__grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.625rem;
}

.dash-quick__btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    padding: 0.625rem 0.5rem;
    background: var(--dash-surface);
    border: 1px solid var(--dash-border);
    border-radius: var(--dash-radius-sm);
    color: var(--dash-text);
    font-size: 0.8125rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
    box-shadow: var(--dash-shadow);
}

.dash-quick__ico {
    font-size: 0.9375rem;
    line-height: 1;
}

.dash-quick__btn:hover {
    background: var(--dash-accent-soft);
    border-color: var(--dash-accent);
    color: var(--dash-accent);
    transform: translateY(-1px);
    box-shadow: var(--dash-shadow-hover);
}

/* ============================================
   Animations
   ============================================ */

@keyframes dashSlideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ============================================
   Responsive
   ============================================ */

@media (max-width: 1024px) {
    .dash-quick__grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 640px) {
    .dash-page { padding: 0 0.75rem 2rem; }
    .dash-hero { padding: 1.5rem; }
    .dash-hero__greeting { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
    .dash-hero__wave { font-size: 2rem; }
    .dash-hero__title { font-size: 1.25rem; }

    .dash-step__num { width: 24px; min-width: 24px; font-size: 0.75rem; }
    .dash-step__body { flex-wrap: wrap; padding: 0.875rem 1rem; gap: 0.75rem; }
    .dash-step__btn { width: 100%; text-align: center; }

    .dash-summary__grid { gap: 1rem; }

    .dash-progress__grid { grid-template-columns: 1fr; }
    .dash-quick__grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
{% endblock %}
