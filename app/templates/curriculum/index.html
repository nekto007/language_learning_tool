{% extends "base.html" %}

{% block title %}{{ _('–û–±—É—á–µ–Ω–∏–µ') }}{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Hero Section: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–∞—è CTA -->
  {% if current_user.is_authenticated %}
    <div class="hero-section mb-4">
      <div class="hero-content">
        <div class="hero-greeting">
          <h1>üëã –ü—Ä–∏–≤–µ—Ç, {{ current_user.name or current_user.username }}!</h1>
          <p class="hero-subtitle">–ü—Ä–æ–¥–æ–ª–∂–∞–π —É—á–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</p>
        </div>

        {% if recent_activity %}
          <div class="hero-cta">
            <a href="{{ get_lesson_url(recent_activity[0]['lesson']) }}"
               class="btn-hero">
              <span class="btn-hero-text">
                <strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Ä–æ–∫</strong>
                <small>{{ recent_activity[0]['lesson'].title }}</small>
              </span>
              <span class="btn-hero-icon">‚Üí</span>
            </a>
          </div>
        {% endif %}
      </div>

      <!-- Gamification Stats -->
      {% if gamification %}
        <div class="gamification-stats">
          <div class="stat-card streak">
            <div class="stat-icon">üî•</div>
            <div class="stat-value">{{ gamification.streak }}</div>
            <div class="stat-label">{{ '–¥–µ–Ω—å' if gamification.streak == 1 else '–¥–Ω—è' if gamification.streak < 5 else '–¥–Ω–µ–π' }} –ø–æ–¥—Ä—è–¥</div>
          </div>

          <div class="stat-card points">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-value">{{ gamification.total_points }}</div>
            <div class="stat-label">–æ—á–∫–æ–≤</div>
          </div>

          <div class="stat-card level">
            <div class="stat-icon">üéØ</div>
            <div class="stat-value">{{ total_stats.progress_percent }}%</div>
            <div class="stat-label">–ø—Ä–æ–π–¥–µ–Ω–æ</div>
          </div>

          <div class="stat-card daily">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-value">{{ gamification.daily_progress }}/{{ gamification.daily_goal }}</div>
            <div class="stat-label">—É—Ä–æ–∫–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
          </div>
        </div>
      {% endif %}
    </div>
  {% endif %}

  <!-- Learning Levels -->
  <div class="section-card mb-4">
    <div class="section-header">
      <h2>üìö {{ _('–£—Ä–æ–≤–Ω–∏ –æ–±—É—á–µ–Ω–∏—è') }}</h2>
      <p class="section-subtitle">{{ _('–í—ã–±–µ—Ä–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∏ –Ω–∞—á–Ω–∏ –æ–±—É—á–µ–Ω–∏–µ') }}</p>
    </div>
    <div class="section-content">
      {% if levels_data %}
        <div class="levels-list">
          {% for level_data in levels_data %}
            {% set is_current = level_data.progress_percent and 0 < level_data.progress_percent < 100 %}
            {% set is_completed = level_data.progress_percent and level_data.progress_percent == 100 %}
            {% set is_new = level_data.progress_percent == 0 %}

            <div class="level-card {{ 'current' if is_current else 'completed' if is_completed else 'new' }}">
              <div class="level-header">
                <div class="level-badge level-{{ level_data.level.code[0]|lower }}">
                  {{ level_data.level.code }}
                </div>
                <div class="level-title">
                  <h3>{{ level_data.level.name }}</h3>
                  <p class="level-desc">{{ level_data.level.description }}</p>
                </div>
                {% if is_completed %}
                  <div class="level-status-badge completed">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω</div>
                {% elif is_current %}
                  <div class="level-status-badge current">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
                {% endif %}
              </div>

              <div class="level-body">
                <div class="level-stats">
                  <div class="level-stat">
                    <div class="level-stat-icon">üìä</div>
                    <div class="level-stat-info">
                      <div class="level-stat-value">{{ level_data.completed_lessons }}/{{ level_data.total_lessons }}</div>
                      <div class="level-stat-label">—É—Ä–æ–∫–æ–≤</div>
                    </div>
                  </div>

                  {% if level_data.estimated_hours > 0 %}
                    <div class="level-stat">
                      <div class="level-stat-icon">‚è±Ô∏è</div>
                      <div class="level-stat-info">
                        <div class="level-stat-value">~{{ level_data.estimated_hours }} —á</div>
                        <div class="level-stat-label">–¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</div>
                      </div>
                    </div>
                  {% endif %}

                  {% if level_data.progress_percent > 0 %}
                    <div class="level-stat">
                      <div class="level-stat-icon">üéØ</div>
                      <div class="level-stat-info">
                        <div class="level-stat-value">{{ level_data.progress_percent }}%</div>
                        <div class="level-stat-label">–ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                      </div>
                    </div>
                  {% endif %}
                </div>

                {% if level_data.progress_percent > 0 %}
                  <div class="level-progress-bar">
                    <div class="progress-track">
                      <div class="progress-fill" style="width: {{ level_data.progress_percent }}%"></div>
                    </div>
                  </div>
                {% endif %}

                <div class="level-actions">
                  {% if level_data.next_lesson and (is_current or is_new) %}
                    {# –ü—Ä—è–º–∞—è –∫–Ω–æ–ø–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É #}
                    <a href="{{ get_lesson_url(level_data.next_lesson) }}"
                       class="btn-level btn-primary">
                      {% if is_current %}
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Ä–æ–∫ ‚Üí
                      {% else %}
                        –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ ‚Üí
                      {% endif %}
                    </a>
                    {# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π #}
                    <a href="/learn/{{ level_data.level.code|lower }}/"
                       class="btn-level btn-outline">
                      –í—Å–µ –º–æ–¥—É–ª–∏
                    </a>
                  {% else %}
                    {# Fallback –∫ —Å–ø–∏—Å–∫—É –º–æ–¥—É–ª–µ–π –µ—Å–ª–∏ –Ω–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–∫–∞ #}
                    <a href="/learn/{{ level_data.level.code|lower }}/"
                       class="btn-level {{ 'btn-primary' if is_current or is_new else 'btn-secondary' }}">
                      {% if is_current %}
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
                      {% elif is_completed %}
                        –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                      {% else %}
                        –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ ‚Üí
                      {% endif %}
                    </a>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          <div class="empty-icon">üìö</div>
          <h4>{{ _('–£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã') }}</h4>
          <p>{{ _('–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—É—Ä—Å–∞') }}</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Recent Activity (Compact) -->
  {% if current_user.is_authenticated and recent_activity and recent_activity|length > 1 %}
    <div class="section-card">
      <div class="section-header">
        <h2>üìù {{ _('–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å') }}</h2>
      </div>
      <div class="section-content p-0">
        <div class="activity-list">
          {% for activity in recent_activity[:5] %}
            <a href="{{ get_lesson_url(activity.lesson) }}" class="activity-item activity-link">
              <div class="activity-dot {{ 'completed' if activity.status == 'completed' else 'in-progress' }}"></div>
              <div class="activity-info">
                <div class="activity-title">{{ activity.lesson.title }}</div>
                <div class="activity-meta">
                  {{ activity.level.code }} ‚Ä¢ {{ _('–ú–æ–¥—É–ª—å') }} {{ activity.module.number }} ‚Ä¢
                  {{ activity.last_activity.strftime('%d.%m %H:%M') }}
                </div>
              </div>
              {% if activity.score %}
                <div class="activity-score">{{ activity.score }}%</div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}

