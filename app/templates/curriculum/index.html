{% extends "base.html" %}

{% block title %}{{ _('–û–±—É—á–µ–Ω–∏–µ') }}{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Hero Section: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–∞—è CTA -->
  {% if current_user.is_authenticated %}
    <div class="hero-section mb-4">
      <div class="hero-content">
        <div class="hero-greeting">
          <h1>üëã –ü—Ä–∏–≤–µ—Ç, {{ current_user.name or current_user.username }}!</h1>
          <p class="hero-subtitle">–ü—Ä–æ–¥–æ–ª–∂–∞–π —É—á–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å</p>
        </div>

        {% if recent_activity %}
          <div class="hero-cta">
            <a href="{{ get_lesson_url(recent_activity[0]['lesson']) }}"
               class="btn-hero">
              <span class="btn-hero-text">
                <strong>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Ä–æ–∫</strong>
                <small>{{ recent_activity[0]['lesson'].title }}</small>
              </span>
              <span class="btn-hero-icon">‚Üí</span>
            </a>
          </div>
        {% endif %}
      </div>

      <!-- Gamification Stats -->
      {% if gamification %}
        <div class="gamification-stats">
          <div class="stat-card streak">
            <div class="stat-icon">üî•</div>
            <div class="stat-value">{{ gamification.streak }}</div>
            <div class="stat-label">{{ '–¥–µ–Ω—å' if gamification.streak == 1 else '–¥–Ω—è' if gamification.streak < 5 else '–¥–Ω–µ–π' }} –ø–æ–¥—Ä—è–¥</div>
          </div>

          <div class="stat-card points">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-value">{{ gamification.total_points }}</div>
            <div class="stat-label">–æ—á–∫–æ–≤</div>
          </div>

          <div class="stat-card level">
            <div class="stat-icon">üéØ</div>
            <div class="stat-value">{{ total_stats.progress_percent }}%</div>
            <div class="stat-label">–ø—Ä–æ–π–¥–µ–Ω–æ</div>
          </div>

          <div class="stat-card daily">
            <div class="stat-icon">‚úÖ</div>
            <div class="stat-value">{{ gamification.daily_progress }}/{{ gamification.daily_goal }}</div>
            <div class="stat-label">—É—Ä–æ–∫–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
          </div>
        </div>
      {% endif %}
    </div>
  {% endif %}

  <!-- Learning Levels -->
  <div class="section-card mb-4">
    <div class="section-header">
      <h2>üìö {{ _('–£—Ä–æ–≤–Ω–∏ –æ–±—É—á–µ–Ω–∏—è') }}</h2>
      <p class="section-subtitle">{{ _('–í—ã–±–µ—Ä–∏ —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å –∏ –Ω–∞—á–Ω–∏ –æ–±—É—á–µ–Ω–∏–µ') }}</p>
    </div>
    <div class="section-content">
      {% if levels_data %}
        <div class="levels-list">
          {% for level_data in levels_data %}
            {% set is_current = level_data.progress_percent and 0 < level_data.progress_percent < 100 %}
            {% set is_completed = level_data.progress_percent and level_data.progress_percent == 100 %}
            {% set is_new = level_data.progress_percent == 0 %}

            <div class="level-card {{ 'current' if is_current else 'completed' if is_completed else 'new' }}">
              <div class="level-header">
                <div class="level-badge level-{{ level_data.level.code[0]|lower }}">
                  {{ level_data.level.code }}
                </div>
                <div class="level-title">
                  <h3>{{ level_data.level.name }}</h3>
                  <p class="level-desc">{{ level_data.level.description }}</p>
                </div>
                {% if is_completed %}
                  <div class="level-status-badge completed">‚úì –ó–∞–≤–µ—Ä—à–µ–Ω</div>
                {% elif is_current %}
                  <div class="level-status-badge current">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
                {% endif %}
              </div>

              <div class="level-body">
                <div class="level-stats">
                  <div class="level-stat">
                    <div class="level-stat-icon">üìä</div>
                    <div class="level-stat-info">
                      <div class="level-stat-value">{{ level_data.completed_lessons }}/{{ level_data.total_lessons }}</div>
                      <div class="level-stat-label">—É—Ä–æ–∫–æ–≤</div>
                    </div>
                  </div>

                  {% if level_data.estimated_hours > 0 %}
                    <div class="level-stat">
                      <div class="level-stat-icon">‚è±Ô∏è</div>
                      <div class="level-stat-info">
                        <div class="level-stat-value">~{{ level_data.estimated_hours }} —á</div>
                        <div class="level-stat-label">–¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</div>
                      </div>
                    </div>
                  {% endif %}

                  {% if level_data.progress_percent > 0 %}
                    <div class="level-stat">
                      <div class="level-stat-icon">üéØ</div>
                      <div class="level-stat-info">
                        <div class="level-stat-value">{{ level_data.progress_percent }}%</div>
                        <div class="level-stat-label">–ø—Ä–æ–≥—Ä–µ—Å—Å</div>
                      </div>
                    </div>
                  {% endif %}
                </div>

                {% if level_data.progress_percent > 0 %}
                  <div class="level-progress-bar">
                    <div class="progress-track">
                      <div class="progress-fill" style="width: {{ level_data.progress_percent }}%"></div>
                    </div>
                  </div>
                {% endif %}

                <div class="level-actions">
                  {% if level_data.next_lesson and (is_current or is_new) %}
                    {# –ü—Ä—è–º–∞—è –∫–Ω–æ–ø–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É #}
                    <a href="{{ get_lesson_url(level_data.next_lesson) }}"
                       class="btn-level btn-primary">
                      {% if is_current %}
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Ä–æ–∫ ‚Üí
                      {% else %}
                        –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ ‚Üí
                      {% endif %}
                    </a>
                    {# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π #}
                    <a href="/learn/{{ level_data.level.code|lower }}/"
                       class="btn-level btn-outline">
                      –í—Å–µ –º–æ–¥—É–ª–∏
                    </a>
                  {% else %}
                    {# Fallback –∫ —Å–ø–∏—Å–∫—É –º–æ–¥—É–ª–µ–π –µ—Å–ª–∏ –Ω–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–∫–∞ #}
                    <a href="/learn/{{ level_data.level.code|lower }}/"
                       class="btn-level {{ 'btn-primary' if is_current or is_new else 'btn-secondary' }}">
                      {% if is_current %}
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚Üí
                      {% elif is_completed %}
                        –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                      {% else %}
                        –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ ‚Üí
                      {% endif %}
                    </a>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-state">
          <div class="empty-icon">üìö</div>
          <h4>{{ _('–£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã') }}</h4>
          <p>{{ _('–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—É—Ä—Å–∞') }}</p>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Recent Activity (Compact) -->
  {% if current_user.is_authenticated and recent_activity and recent_activity|length > 1 %}
    <div class="section-card">
      <div class="section-header">
        <h2>üìù {{ _('–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å') }}</h2>
      </div>
      <div class="section-content p-0">
        <div class="activity-list">
          {% for activity in recent_activity[:5] %}
            <a href="{{ get_lesson_url(activity.lesson) }}" class="activity-item activity-link">
              <div class="activity-dot {{ 'completed' if activity.status == 'completed' else 'in-progress' }}"></div>
              <div class="activity-info">
                <div class="activity-title">{{ activity.lesson.title }}</div>
                <div class="activity-meta">
                  {{ activity.level.code }} ‚Ä¢ {{ _('–ú–æ–¥—É–ª—å') }} {{ activity.module.number }} ‚Ä¢
                  {{ activity.last_activity.strftime('%d.%m %H:%M') }}
                </div>
              </div>
              {% if activity.score %}
                <div class="activity-score">{{ activity.score }}%</div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block styles %}
<style>
  :root {
    --primary: #0d6efd;
    --primary-dark: #0b5ed7;
    --success: #198754;
    --warning: #ffc107;
    --danger: #dc3545;
    --info: #0dcaf0;
    --light: #f8f9fa;
    --dark: #212529;
    --muted: #6c757d;
    --border: #dee2e6;
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.12);
    --radius: 12px;
    --radius-sm: 8px;
  }

  /* Hero Section */
  .hero-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: var(--radius);
    padding: 2rem;
    color: white;
    box-shadow: var(--shadow-lg);
  }

  .hero-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .hero-greeting h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0 0 0.5rem 0;
  }

  .hero-subtitle {
    font-size: 1.125rem;
    opacity: 0.9;
    margin: 0;
  }

  .btn-hero {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: white;
    color: var(--dark);
    padding: 1.25rem 2rem;
    border-radius: var(--radius-sm);
    text-decoration: none;
    font-size: 1.125rem;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
    min-width: 320px;
    gap: 1rem;
  }

  .btn-hero:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    color: var(--primary);
  }

  .btn-hero-text {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.25rem;
  }

  .btn-hero-text strong {
    font-size: 1.125rem;
  }

  .btn-hero-text small {
    font-size: 0.875rem;
    font-weight: 400;
    opacity: 0.7;
  }

  .btn-hero-icon {
    font-size: 1.5rem;
    transition: transform 0.3s ease;
  }

  .btn-hero:hover .btn-hero-icon {
    transform: translateX(4px);
  }

  /* Gamification Stats */
  .gamification-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .stat-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-sm);
    padding: 1rem;
    text-align: center;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
  }

  .stat-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    font-size: 0.875rem;
    opacity: 0.9;
  }

  /* Section Cards */
  .section-card {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .section-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
    background: var(--light);
  }

  .section-header h2 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--dark);
  }

  .section-subtitle {
    margin: 0.5rem 0 0 0;
    font-size: 0.875rem;
    color: var(--muted);
  }

  .section-content {
    padding: 1.5rem;
  }

  .section-content.p-0 {
    padding: 0;
  }

  /* Level Cards */
  .levels-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .level-card {
    background: white;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .level-card:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow-lg);
  }

  .level-card.current {
    border-color: var(--primary);
    background: linear-gradient(to right, rgba(13, 110, 253, 0.02), white);
  }

  .level-card.completed {
    border-color: var(--success);
    background: linear-gradient(to right, rgba(25, 135, 84, 0.02), white);
  }

  .level-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--light);
    border-bottom: 1px solid var(--border);
  }

  .level-badge {
    width: 56px;
    height: 56px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.125rem;
    flex-shrink: 0;
  }

  .level-a { background: #e3f2fd; color: #1976d2; }
  .level-b { background: #fff3e0; color: #f57c00; }
  .level-c { background: #ffebee; color: #d32f2f; }

  .level-title {
    flex: 1;
  }

  .level-title h3 {
    margin: 0 0 0.25rem 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .level-desc {
    margin: 0;
    font-size: 0.875rem;
    color: var(--muted);
  }

  .level-status-badge {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .level-status-badge.completed {
    background: rgba(25, 135, 84, 0.1);
    color: var(--success);
  }

  .level-status-badge.current {
    background: rgba(13, 110, 253, 0.1);
    color: var(--primary);
  }

  .level-body {
    padding: 1.5rem;
  }

  .level-stats {
    display: flex;
    gap: 2rem;
    margin-bottom: 1rem;
  }

  .level-stat {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .level-stat-icon {
    font-size: 1.5rem;
  }

  .level-stat-value {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--dark);
  }

  .level-stat-label {
    font-size: 0.75rem;
    color: var(--muted);
  }

  .level-progress-bar {
    margin-bottom: 1.5rem;
  }

  .progress-track {
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--success));
    transition: width 0.6s ease;
    border-radius: 4px;
  }

  .level-actions {
    display: flex;
    gap: 1rem;
  }

  .btn-level {
    padding: 0.75rem 2rem;
    border-radius: var(--radius-sm);
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    display: inline-block;
  }

  .btn-primary {
    background: var(--primary);
    color: white;
  }

  .btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
  }

  .btn-secondary {
    background: var(--light);
    color: var(--dark);
    border: 1px solid var(--border);
  }

  .btn-secondary:hover {
    background: var(--border);
  }

  .btn-outline {
    background: transparent;
    color: var(--primary);
    border: 2px solid var(--primary);
  }

  .btn-outline:hover {
    background: var(--primary);
    color: white;
  }

  /* Activity List */
  .activity-list {
    display: flex;
    flex-direction: column;
  }

  .activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border);
    transition: all 0.2s ease;
  }

  .activity-item:last-child {
    border-bottom: none;
  }

  .activity-link {
    text-decoration: none;
    color: inherit;
  }

  .activity-link:hover {
    background: var(--light);
    transform: translateX(4px);
  }

  .activity-link:hover .activity-title {
    color: var(--primary);
  }

  .activity-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .activity-dot.completed {
    background: var(--success);
  }

  .activity-dot.in-progress {
    background: var(--primary);
  }

  .activity-info {
    flex: 1;
  }

  .activity-title {
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
  }

  .activity-meta {
    font-size: 0.75rem;
    color: var(--muted);
  }

  .activity-score {
    font-weight: 700;
    color: var(--success);
    font-size: 0.875rem;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--muted);
  }

  .empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .empty-state h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1.125rem;
  }

  .empty-state p {
    margin: 0;
    font-size: 0.875rem;
  }

  /* Responsive */
  @media (max-width: 992px) {
    .gamification-stats {
      grid-template-columns: repeat(2, 1fr);
    }

    .hero-content {
      flex-direction: column;
      align-items: stretch;
    }

    .btn-hero {
      min-width: auto;
    }
  }

  @media (max-width: 768px) {
    .hero-section {
      padding: 1.5rem;
    }

    .hero-greeting h1 {
      font-size: 1.5rem;
    }

    .gamification-stats {
      gap: 0.75rem;
    }

    .stat-card {
      padding: 0.75rem;
    }

    .stat-icon {
      font-size: 1.5rem;
    }

    .stat-value {
      font-size: 1.25rem;
    }

    .level-stats {
      flex-direction: column;
      gap: 0.75rem;
    }

    .level-header {
      flex-wrap: wrap;
    }

    .level-badge {
      width: 48px;
      height: 48px;
      font-size: 1rem;
    }
  }

  @media (max-width: 576px) {
    .section-header,
    .section-content {
      padding: 1rem;
    }

    .level-header {
      padding: 1rem;
    }

    .level-body {
      padding: 1rem;
    }
  }
</style>
{% endblock %}
