{% extends "base.html" %}

{% block title %}{{ _('–î–∞—à–±–æ—Ä–¥ –∏–∑—É—á–µ–Ω–∏—è') }}{% endblock %}

{% block styles %}
{{ super() }}
<style>
.study-hero {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 16px;
    padding: 3rem 2rem;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}

.study-hero::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 0c0-11.046 8.954-20 20-20s20 8.954 20 20-8.954 20-20 20-20-8.954-20-20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
    opacity: 0.1;
}

.study-hero-content {
    position: relative;
    z-index: 1;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #6c757d;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.action-card {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.recommended-session {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    border: none;
    padding: 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}

.recommended-session::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpolygon points='20,0 32,12 20,24 8,12'/%3E%3C/g%3E%3C/svg%3E") repeat;
    opacity: 0.1;
}

.recommended-content {
    position: relative;
    z-index: 1;
}

.study-modes {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.mode-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 2px solid transparent;
    transition: all 0.3s ease;
    cursor: pointer;
}

.mode-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    border-color: #007bff;
}

.mode-card.recommended {
    border-color: #28a745;
    background: linear-gradient(135deg, #f8fff8 0%, #e6ffe6 100%);
}

.mode-card.recommended .mode-badge {
    background: #28a745;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.mode-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 1rem;
}

.mode-icon.cards { background: #e3f2fd; color: #1976d2; }
.mode-icon.quiz { background: #fff3e0; color: #f57c00; }
.mode-icon.matching { background: #ffebee; color: #d32f2f; }

.difficulty-indicator {
    display: flex;
    gap: 0.25rem;
    margin-top: 0.5rem;
}

.difficulty-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #dee2e6;
}

.difficulty-dot.filled { background: #28a745; }

.session-stats {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
}

.goal-progress {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.progress-ring {
    width: 80px;
    height: 80px;
    position: relative;
}

.progress-ring svg {
    transform: rotate(-90deg);
}

.progress-ring-circle {
    fill: none;
    stroke: #e9ecef;
    stroke-width: 8;
}

.progress-ring-progress {
    fill: none;
    stroke: #28a745;
    stroke-width: 8;
    stroke-linecap: round;
    transition: stroke-dasharray 0.5s ease;
}

.achievement-badge {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    color: #b8860b;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.motivation-message {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin: 1rem 0;
    position: relative;
}

.smart-recommendations {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
    border-left: 4px solid #007bff;
}

.time-selection {
    display: flex;
    gap: 1rem;
    margin: 1rem 0;
}

.time-btn {
    flex: 1;
    padding: 0.75rem;
    border: 2px solid #e9ecef;
    background: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    text-align: center;
}

.time-btn:hover, .time-btn.active {
    border-color: #007bff;
    background: #f8f9ff;
    color: #007bff;
}

@media (max-width: 768px) {
    .study-modes {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .time-selection {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Hero Section with Personalized Greeting -->
    <div class="study-hero">
        <div class="study-hero-content">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-5 fw-bold mb-3">
                        {% if current_time_hour < 12 %}
                            {{ _('–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!') }} üåÖ
                        {% elif current_time_hour < 18 %}
                            {{ _('–î–æ–±—Ä—ã–π –¥–µ–Ω—å!') }} ‚òÄÔ∏è
                        {% else %}
                            {{ _('–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä!') }} üåô
                        {% endif %}
                    </h1>
                    <p class="lead mb-0">
                        {% if due_items_count > 0 %}
                            {{ _('–£ –≤–∞—Å –µ—Å—Ç—å %(count)d —Å–ª–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è', count=due_items_count) }}
                        {% elif total_items == 0 %}
                            {{ _('–ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –∏–∑—É—á–µ–Ω–∏–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ!') }}
                        {% else %}
                            {{ _('–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –í—Å–µ —Å–ª–æ–≤–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã.') }}
                        {% endif %}
                    </p>
                </div>
                <div class="col-lg-4 text-end">
                    {% if user_streak > 0 %}
                        <div class="achievement-badge mb-2">
                            <i class="fas fa-fire"></i>
                            {{ user_streak }} {{ _('–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥') }}
                        </div>
                    {% endif %}
                    <div class="d-flex flex-column align-items-end">
                        <div class="fs-1 fw-bold">{{ due_items_count }}</div>
                        <div class="opacity-75">{{ _('–∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é') }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Goal Progress -->
    {% if daily_goal %}
    <div class="goal-progress">
        <div class="row align-items-center">
            <div class="col-auto">
                <div class="progress-ring">
                    <svg width="80" height="80">
                        <circle class="progress-ring-circle" cx="40" cy="40" r="36"></circle>
                        <circle class="progress-ring-progress" cx="40" cy="40" r="36" 
                                stroke-dasharray="{{ (daily_progress / daily_goal * 226) if daily_goal > 0 else 0 }} 226"></circle>
                    </svg>
                    <div class="position-absolute top-50 start-50 translate-middle text-center">
                        <div class="fw-bold">{{ daily_progress }}</div>
                        <small class="text-muted">{{ daily_goal }}</small>
                    </div>
                </div>
            </div>
            <div class="col">
                <h4 class="mb-1">{{ _('–î–Ω–µ–≤–Ω–∞—è —Ü–µ–ª—å') }}</h4>
                <p class="text-muted mb-2">{{ _('–ò–∑—É—á–µ–Ω–æ %(progress)d –∏–∑ %(goal)d —Å–ª–æ–≤', progress=daily_progress, goal=daily_goal) }}</p>
                {% if daily_progress >= daily_goal %}
                    <div class="motivation-message">
                        <i class="fas fa-trophy me-2"></i>
                        {{ _('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –¥–Ω–µ–≤–Ω–æ–π —Ü–µ–ª–∏!') }}
                    </div>
                {% elif daily_progress > 0 %}
                    <div class="motivation-message">
                        <i class="fas fa-thumbs-up me-2"></i>
                        {{ _('–û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ! –û—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ %(remaining)d —Å–ª–æ–≤.', remaining=daily_goal - daily_progress) }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Smart Recommendations -->
    {% if recommended_action %}
    <div class="recommended-session">
        <div class="recommended-content">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="d-flex align-items-center mb-2">
                        <i class="fas fa-lightbulb me-2"></i>
                        <span class="badge bg-warning text-dark">{{ _('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è') }}</span>
                    </div>
                    <h3 class="mb-2">{{ recommended_action.title }}</h3>
                    <p class="mb-3">{{ recommended_action.description }}</p>
                    <div class="session-stats">
                        <small class="text-white-50">
                            <i class="fas fa-clock me-1"></i> {{ recommended_action.estimated_time }} {{ _('–º–∏–Ω') }} |
                            <i class="fas fa-list me-1"></i> {{ recommended_action.word_count }} {{ _('—Å–ª–æ–≤') }} |
                            <i class="fas fa-chart-line me-1"></i> {{ recommended_action.difficulty }}
                        </small>
                    </div>
                </div>
                <div class="col-lg-4 text-end">
                    <a href="{{ recommended_action.url }}" class="btn btn-light btn-lg">
                        <i class="fas fa-play me-2"></i>{{ _('–ù–∞—á–∞—Ç—å') }}
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Time-based Sessions -->
    <div class="action-card">
        <h3 class="mb-3">{{ _('–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç') }}</h3>
        <p class="text-muted mb-3">{{ _('–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è?') }}</p>
        
        <div class="time-selection">
            <div class="time-btn" data-time="5">
                <div class="fw-bold">5 {{ _('–º–∏–Ω') }}</div>
                <small class="text-muted">{{ _('~10 —Å–ª–æ–≤') }}</small>
            </div>
            <div class="time-btn" data-time="15">
                <div class="fw-bold">15 {{ _('–º–∏–Ω') }}</div>
                <small class="text-muted">{{ _('~25 —Å–ª–æ–≤') }}</small>
            </div>
            <div class="time-btn" data-time="30">
                <div class="fw-bold">30 {{ _('–º–∏–Ω') }}</div>
                <small class="text-muted">{{ _('~50 —Å–ª–æ–≤') }}</small>
            </div>
        </div>
        
        <div class="text-center mt-3">
            <button class="btn btn-primary btn-lg" id="startQuickSession" disabled>
                <i class="fas fa-rocket me-2"></i>{{ _('–ù–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é') }}
            </button>
        </div>
    </div>

    <!-- Study Mode Selection -->
    <div class="action-card">
        <h3 class="mb-3">{{ _('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∏–∑—É—á–µ–Ω–∏—è') }}</h3>
        <div class="study-modes">
            <div class="mode-card" data-mode="cards">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div class="mode-icon cards">
                        <i class="fas fa-copy"></i>
                    </div>
                    {% if user_level == 'beginner' %}
                        <span class="mode-badge">{{ _('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è') }}</span>
                    {% endif %}
                </div>
                <h4>{{ _('–ö–∞—Ä—Ç–æ—á–∫–∏') }}</h4>
                <p class="text-muted mb-2">{{ _('–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –∏–∑—É—á–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–º–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏') }}</p>
                <div class="difficulty-indicator">
                    <div class="difficulty-dot filled"></div>
                    <div class="difficulty-dot"></div>
                    <div class="difficulty-dot"></div>
                </div>
                <small class="text-muted">{{ _('–õ–µ–≥–∫–æ') }}</small>
            </div>

            <div class="mode-card" data-mode="quiz">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div class="mode-icon quiz">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    {% if user_level == 'intermediate' %}
                        <span class="mode-badge">{{ _('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è') }}</span>
                    {% endif %}
                </div>
                <h4>{{ _('–¢–µ—Å—Ç—ã') }}</h4>
                <p class="text-muted mb-2">{{ _('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤') }}</p>
                <div class="difficulty-indicator">
                    <div class="difficulty-dot filled"></div>
                    <div class="difficulty-dot filled"></div>
                    <div class="difficulty-dot"></div>
                </div>
                <small class="text-muted">{{ _('–°—Ä–µ–¥–Ω–µ') }}</small>
            </div>

            <div class="mode-card" data-mode="matching">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <div class="mode-icon matching">
                        <i class="fas fa-puzzle-piece"></i>
                    </div>
                    {% if user_level == 'advanced' %}
                        <span class="mode-badge">{{ _('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è') }}</span>
                    {% endif %}
                </div>
                <h4>{{ _('–ò–≥—Ä–∞ –Ω–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è') }}</h4>
                <p class="text-muted mb-2">{{ _('–í–µ—Å–µ–ª–æ –∏–∑—É—á–∞–π—Ç–µ —á–µ—Ä–µ–∑ –∏–≥—Ä–æ–≤–æ–π –ø—Ä–æ—Ü–µ—Å—Å') }}</p>
                <div class="difficulty-indicator">
                    <div class="difficulty-dot filled"></div>
                    <div class="difficulty-dot filled"></div>
                    <div class="difficulty-dot filled"></div>
                </div>
                <small class="text-muted">{{ _('–°–ª–æ–∂–Ω–æ') }}</small>
            </div>
        </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number text-primary">{{ due_items_count }}</div>
            <div class="stat-label">{{ _('–ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é') }}</div>
            {% if due_items_count > 0 %}
                <small class="text-success">{{ _('–ì–æ—Ç–æ–≤—ã –∫ –∏–∑—É—á–µ–Ω–∏—é!') }}</small>
            {% endif %}
        </div>
        
        <div class="stat-card">
            <div class="stat-number text-success">{{ total_items }}</div>
            <div class="stat-label">{{ _('–í—Å–µ–≥–æ —Å–ª–æ–≤') }}</div>
            {% if total_items > 0 %}
                <small class="text-muted">{{ _('–í –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏') }}</small>
            {% endif %}
        </div>
        
        <div class="stat-card">
            <div class="stat-number text-info">{{ learned_percentage }}%</div>
            <div class="stat-label">{{ _('–ü—Ä–æ–≥—Ä–µ—Å—Å –∏–∑—É—á–µ–Ω–∏—è') }}</div>
            <div class="progress mt-2" style="height: 4px;">
                <div class="progress-bar bg-info" style="width: {{ learned_percentage }}%"></div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-number text-warning">{{ user_streak }}</div>
            <div class="stat-label">{{ _('–î–Ω–µ–π –ø–æ–¥—Ä—è–¥') }}</div>
            {% if user_streak > 0 %}
                <small class="text-success">
                    <i class="fas fa-fire me-1"></i>{{ _('–û—Ç–ª–∏—á–Ω–∞—è —Å–µ—Ä–∏—è!') }}
                </small>
            {% endif %}
        </div>
    </div>

    <!-- Advanced Options (Collapsible) -->
    <div class="action-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">{{ _('–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏') }}</h4>
            <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#advancedOptions">
                <i class="fas fa-cog me-1"></i>{{ _('–ù–∞—Å—Ç—Ä–æ–∏—Ç—å') }}
            </button>
        </div>
        
        <div class="collapse" id="advancedOptions">
            <form method="POST" action="{{ url_for('study.start_session') }}">
                {{ form.csrf_token }}
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">{{ _('–†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è') }}</label>
                        {{ form.session_type(class="form-select") }}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">{{ _('–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–ª–æ–≤') }}</label>
                        {{ form.word_source(class="form-select") }}
                    </div>
                </div>
                <div class="d-flex justify-content-between mt-3">
                    {{ form.submit(class="btn btn-primary btn-lg px-4", value=_('–ù–∞—á–∞—Ç—å —Å–µ–∞–Ω—Å')) }}
                    <a href="{{ url_for('study.settings') }}" class="btn btn-outline-secondary px-4">
                        <i class="fas fa-cog me-2"></i> {{ _('–ù–∞—Å—Ç—Ä–æ–π–∫–∏') }}
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Recent Sessions (if any) -->
    {% if recent_sessions %}
    <div class="action-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0">{{ _('–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–µ—Å—Å–∏–∏') }}</h3>
            <a href="{{ url_for('study.stats') }}" class="btn btn-outline-primary btn-sm">{{ _('–í—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞') }}</a>
        </div>
        
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>{{ _('–î–∞—Ç–∞') }}</th>
                        <th>{{ _('–¢–∏–ø') }}</th>
                        <th>{{ _('–°–ª–æ–≤–∞') }}</th>
                        <th>{{ _('–¢–æ—á–Ω–æ—Å—Ç—å') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in recent_sessions[:3] %}
                    <tr>
                        <td>{{ session.start_time.strftime('%d.%m, %H:%M') }}</td>
                        <td>{{ _(session.session_type|capitalize) }}</td>
                        <td>{{ session.words_studied }}</td>
                        <td>
                            <span class="badge {% if session.performance_percentage >= 80 %}bg-success{% elif session.performance_percentage >= 60 %}bg-warning{% else %}bg-danger{% endif %}">
                                {{ session.performance_percentage }}%
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Time selection functionality
    const timeButtons = document.querySelectorAll('.time-btn');
    const startButton = document.getElementById('startQuickSession');
    let selectedTime = null;

    timeButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            timeButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            selectedTime = this.dataset.time;
            startButton.disabled = false;
        });
    });

    // Quick session start
    startButton.addEventListener('click', function() {
        if (selectedTime) {
            // Determine best mode and word source based on time and user data
            let mode = 'cards';
            let source = 'learning';
            
            if ({{ due_items_count }} > 0) {
                source = 'learning';
            } else if ({{ total_items }} === 0) {
                source = 'new';
            } else {
                source = 'all';
            }
            
            // Redirect to appropriate study mode
            window.location.href = `/study/${mode}?word_source=${source}&time_limit=${selectedTime}`;
        }
    });

    // Mode card selection
    const modeCards = document.querySelectorAll('.mode-card');
    modeCards.forEach(card => {
        card.addEventListener('click', function() {
            const mode = this.dataset.mode;
            let source = 'learning';
            
            if ({{ due_items_count }} > 0) {
                source = 'learning';
            } else if ({{ total_items }} === 0) {
                source = 'new';
            } else {
                source = 'all';
            }
            
            window.location.href = `/study/${mode}?word_source=${source}`;
        });
    });
});
</script>
{% endblock %}