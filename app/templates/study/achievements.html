{% extends "base.html" %}

{% block title %}–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="card shadow-lg mb-4 hero-gradient-card">
        <div class="card-body p-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2"><i class="fas fa-trophy me-2"></i>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h1>
                    <p class="mb-0 opacity-90">–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ —É—Å–ø–µ—Ö–∏ –≤ –æ–±—É—á–µ–Ω–∏–∏</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="mb-2">
                        <div class="fs-2 fw-bold">{{ earned_count }}/{{ total_achievements }}</div>
                        <div class="opacity-75">–ü–æ–ª—É—á–µ–Ω–æ</div>
                    </div>
                    <div class="progress" style="height: 8px; background: rgba(255,255,255,0.2);">
                        <div class="progress-bar" style="width: {{ (earned_count / total_achievements * 100) if total_achievements > 0 else 0 }}%; background: rgba(255,255,255,0.9);"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- XP Stats -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="me-3" style="font-size: 48px;">‚ö°</div>
                        <div>
                            <div class="fs-4 fw-bold text-primary">{{ earned_xp }} XP</div>
                            <div class="text-muted">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∏–∑ {{ total_xp_available }} XP</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="me-3" style="font-size: 48px;">üìä</div>
                        <div>
                            <div class="fs-4 fw-bold text-success">{{ ((earned_count / total_achievements * 100)|int) if total_achievements > 0 else 0 }}%</div>
                            <div class="text-muted">–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements by Category -->
    {% set category_names = {
        'quiz': 'üéØ –ö–≤–∏–∑—ã',
        'study': 'üìö –û–±—É—á–µ–Ω–∏–µ',
        'streak': 'üî• –°–µ—Ä–∏–∏',
        'special': '‚ú® –û—Å–æ–±—ã–µ',
        'books': 'üìñ –ö–Ω–∏–≥–∏',
        'flashcards': 'üé¥ –ö–∞—Ä—Ç–æ—á–∫–∏',
        'matching': 'üéä –°–æ–≤–ø–∞–¥–µ–Ω–∏—è',
        'lessons': 'üéì –£—Ä–æ–∫–∏',
        'levels': 'üåü –£—Ä–æ–≤–Ω–∏'
    } %}

    {% for category, achievements in achievements_by_category.items() %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
            <h3 class="mb-0">{{ category_names.get(category, category.title()) }}</h3>
            <small class="text-muted">
                {{ achievements|selectattr('earned', 'equalto', True)|list|length }}/{{ achievements|length }} –ø–æ–ª—É—á–µ–Ω–æ
            </small>
        </div>
        <div class="card-body">
            <div class="row g-3">
                {% for item in achievements %}
                {% set ach = item.achievement %}
                {% set earned = item.earned %}
                {% set earned_at = item.earned_at %}

                <div class="col-md-6 col-lg-4">
                    <div class="achievement-card {% if earned %}earned{% else %}locked{% endif %}">
                        <!-- Earned badge -->
                        {% if earned %}
                        <div class="achievement-earned-badge">
                            <i class="fas fa-check me-1"></i>–ü–æ–ª—É—á–µ–Ω–æ
                        </div>
                        {% endif %}

                        <!-- Icon -->
                        <div style="font-size: 48px; margin-bottom: 12px;">{{ ach.icon }}</div>

                        <!-- Title and description -->
                        <h5 class="mb-2 fw-bold" style="{% if not earned %}color: #6c757d;{% endif %}">{{ ach.name }}</h5>
                        <p class="mb-2 small" style="{% if not earned %}color: #6c757d;{% endif %}">{{ ach.description }}</p>

                        <!-- XP reward -->
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <span class="achievement-xp-badge {% if earned %}earned{% else %}locked{% endif %}">
                                +{{ ach.xp_reward }} XP
                            </span>

                            {% if earned and earned_at %}
                            <small class="text-muted">
                                {{ earned_at.strftime('%d.%m.%Y') }}
                            </small>
                            {% endif %}
                        </div>

                        <!-- Progress hint for locked achievements -->
                        {% if not earned %}
                        <div class="mt-2 small text-muted">
                            <i class="fas fa-lock me-1"></i>–ï—â—ë –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Styles moved to design-system.css -->
{% endblock %}
