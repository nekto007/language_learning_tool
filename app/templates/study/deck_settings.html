{% extends "base.html" %}

{% block title %}Настройки: {{ deck.title }}{% endblock %}

{% block content %}
<div class="ds-page">

    <!-- Hero Section -->
    <div class="ds-hero slideUp">
        <div class="ds-hero__shapes">
            <div class="ds-hero__circle ds-hero__circle--1"></div>
            <div class="ds-hero__circle ds-hero__circle--2"></div>
            <div class="ds-hero__circle ds-hero__circle--3"></div>
        </div>
        <div class="ds-hero__content">
            <a href="{{ url_for('study.index') }}" class="ds-hero__back">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </a>
            <div class="ds-hero__icon">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/>
                </svg>
            </div>
            <div>
                <h1 class="ds-hero__title">Настройки</h1>
                <p class="ds-hero__subtitle">{{ deck.title }}</p>
            </div>
        </div>
    </div>

    <!-- Auto Deck Notice -->
    {% if is_auto %}
    <div class="ds-notice slideUp" style="animation-delay: .1s">
        <div class="ds-notice__icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
        </div>
        <p class="ds-notice__text">Это автоматическая колода. Вы можете настроить дневные лимиты, но не можете изменять её содержимое.</p>
    </div>
    {% endif %}

    <!-- Daily Limits Card -->
    <div class="ds-card slideUp" style="animation-delay: .15s">
        <div class="ds-card__header">
            <div class="ds-card__header-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="4" y1="21" x2="4" y2="14"/>
                    <line x1="4" y1="10" x2="4" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12" y2="3"/>
                    <line x1="20" y1="21" x2="20" y2="16"/>
                    <line x1="20" y1="12" x2="20" y2="3"/>
                    <line x1="1" y1="14" x2="7" y2="14"/>
                    <line x1="9" y1="8" x2="15" y2="8"/>
                    <line x1="17" y1="16" x2="23" y2="16"/>
                </svg>
            </div>
            <h2 class="ds-card__title">Дневные лимиты</h2>
        </div>
        <div class="ds-card__body">
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                <p class="ds-card__desc">
                    Установите индивидуальные лимиты для этой колоды.
                    Оставьте поля пустыми, чтобы использовать глобальные настройки
                    {% if user_settings %}
                    (новых: {{ user_settings.new_words_per_day }}, повторений: {{ user_settings.reviews_per_day }})
                    {% endif %}.
                </p>

                <div class="ds-form__row">
                    <div class="ds-form__group">
                        <label for="new_words_per_day" class="ds-form__label">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="16"/>
                                <line x1="8" y1="12" x2="16" y2="12"/>
                            </svg>
                            Новых слов в день
                        </label>
                        <input type="number" class="ds-form__input" id="new_words_per_day" name="new_words_per_day"
                               min="0" max="100"
                               value="{{ deck.new_words_per_day if deck.new_words_per_day is not none else '' }}"
                               placeholder="Глобальные настройки{% if user_settings %} ({{ user_settings.new_words_per_day }}){% endif %}">
                        <span class="ds-form__hint">Максимум новых карточек для изучения в день</span>
                    </div>
                    <div class="ds-form__group">
                        <label for="reviews_per_day" class="ds-form__label">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="23 4 23 10 17 10"/>
                                <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
                            </svg>
                            Повторений в день
                        </label>
                        <input type="number" class="ds-form__input" id="reviews_per_day" name="reviews_per_day"
                               min="0" max="500"
                               value="{{ deck.reviews_per_day if deck.reviews_per_day is not none else '' }}"
                               placeholder="Глобальные настройки{% if user_settings %} ({{ user_settings.reviews_per_day }}){% endif %}">
                        <span class="ds-form__hint">Максимум карточек для повторения в день</span>
                    </div>
                </div>

                <div class="ds-form__actions">
                    <a href="{{ url_for('study.index') }}" class="ds-btn ds-btn--secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                        Отмена
                    </a>
                    <button type="submit" class="ds-btn ds-btn--primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        Сохранить
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Deck Info Card -->
    <div class="ds-card slideUp" style="animation-delay: .25s">
        <div class="ds-card__header">
            <div class="ds-card__header-icon ds-card__header-icon--info">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
            </div>
            <h2 class="ds-card__title">Информация о колоде</h2>
        </div>
        <div class="ds-card__body">
            <div class="ds-info">
                <div class="ds-info__row">
                    <span class="ds-info__label">Название</span>
                    <span class="ds-info__value">{{ deck.title }}</span>
                </div>

                {% if deck.description %}
                <div class="ds-info__row">
                    <span class="ds-info__label">Описание</span>
                    <span class="ds-info__value">{{ deck.description }}</span>
                </div>
                {% endif %}

                <div class="ds-info__row">
                    <span class="ds-info__label">Слов в колоде</span>
                    <span class="ds-info__value ds-info__value--highlight">{{ deck.words.count() }}</span>
                </div>

                <div class="ds-info__row">
                    <span class="ds-info__label">Текущие лимиты</span>
                    <span class="ds-info__value">
                        {% if deck.new_words_per_day is not none or deck.reviews_per_day is not none %}
                            Новых: {{ deck.new_words_per_day if deck.new_words_per_day is not none else 'глобальные' }},
                            Повторений: {{ deck.reviews_per_day if deck.reviews_per_day is not none else 'глобальные' }}
                        {% else %}
                            Используются глобальные настройки
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>

</div>

<style>
@import url('https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700&display=swap');

/* ── Scoped Variables ── */
.ds-page {
    --ds-font: 'Onest', -apple-system, BlinkMacSystemFont, sans-serif;
    --ds-primary: #f59e0b;
    --ds-primary-dark: #d97706;
    --ds-gradient: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
    --ds-surface: #ffffff;
    --ds-surface-alt: #f8fafc;
    --ds-text: #0f172a;
    --ds-text-muted: #64748b;
    --ds-border: #e2e8f0;
    --ds-radius: 16px;
    --ds-radius-sm: 10px;
    --ds-shadow: 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
    --ds-shadow-md: 0 4px 12px rgba(0,0,0,.08);

    font-family: var(--ds-font);
    max-width: 900px;
    margin: 0 auto;
    padding: 0 1rem 3rem;
    color: var(--ds-text);
}

/* ── Animations ── */
@keyframes ds-slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
}

@keyframes ds-float-1 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50%      { transform: translate(-20px, 15px) scale(1.08); }
}

@keyframes ds-float-2 {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    50%      { transform: translate(25px, -20px) rotate(10deg); }
}

@keyframes ds-float-3 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50%      { transform: translate(-10px, -15px) scale(1.05); }
}

.slideUp {
    animation: ds-slideUp .5s ease both;
}

/* ── Hero ── */
.ds-hero {
    position: relative;
    background: var(--ds-gradient);
    border-radius: var(--ds-radius);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    overflow: hidden;
    color: #fff;
}

.ds-hero__shapes {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
}

.ds-hero__circle {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, .12);
}

.ds-hero__circle--1 {
    width: 160px;
    height: 160px;
    top: -50px;
    right: -40px;
    animation: ds-float-1 18s ease-in-out infinite;
}

.ds-hero__circle--2 {
    width: 90px;
    height: 90px;
    bottom: -30px;
    left: 10%;
    animation: ds-float-2 14s ease-in-out infinite;
}

.ds-hero__circle--3 {
    width: 60px;
    height: 60px;
    top: 20%;
    left: 50%;
    animation: ds-float-3 20s ease-in-out infinite;
}

.ds-hero__content {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.ds-hero__back {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, .18);
    border-radius: 10px;
    color: #fff;
    text-decoration: none;
    transition: background .2s ease;
    flex-shrink: 0;
    backdrop-filter: blur(10px);
}

.ds-hero__back:hover {
    background: rgba(255, 255, 255, .3);
}

.ds-hero__icon {
    width: 52px;
    height: 52px;
    background: rgba(255, 255, 255, .2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    flex-shrink: 0;
}

.ds-hero__title {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0;
    line-height: 1.2;
    letter-spacing: -0.02em;
}

.ds-hero__subtitle {
    font-size: 0.875rem;
    margin: 0.25rem 0 0;
    opacity: 0.9;
}

/* ── Notice ── */
.ds-notice {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    background: #eff6ff;
    border: 1px solid #bfdbfe;
    border-radius: var(--ds-radius-sm);
    padding: 1rem 1.25rem;
    margin-bottom: 1.5rem;
}

.ds-notice__icon {
    flex-shrink: 0;
    color: #3b82f6;
    margin-top: 1px;
}

.ds-notice__text {
    margin: 0;
    font-size: 0.9375rem;
    line-height: 1.5;
    color: #1e40af;
}

/* ── Card ── */
.ds-card {
    background: var(--ds-surface);
    border: 1px solid var(--ds-border);
    border-radius: var(--ds-radius);
    overflow: hidden;
    margin-bottom: 1.5rem;
    box-shadow: var(--ds-shadow);
}

.ds-card__header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1.125rem 1.5rem;
    border-bottom: 1px solid var(--ds-border);
    background: var(--ds-surface-alt);
}

.ds-card__header-icon {
    width: 40px;
    height: 40px;
    background: var(--ds-gradient);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    flex-shrink: 0;
}

.ds-card__header-icon--info {
    background: linear-gradient(135deg, #64748b 0%, #475569 100%);
}

.ds-card__title {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0;
    letter-spacing: -0.01em;
}

.ds-card__body {
    padding: 1.5rem;
}

.ds-card__desc {
    font-size: 0.9375rem;
    color: var(--ds-text-muted);
    line-height: 1.6;
    margin: 0 0 1.5rem;
}

/* ── Form ── */
.ds-form__row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.ds-form__group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.ds-form__label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--ds-text);
}

.ds-form__input {
    width: 100%;
    padding: 0.75rem 1rem;
    font-family: var(--ds-font);
    font-size: 0.9375rem;
    color: var(--ds-text);
    background: var(--ds-surface);
    border: 1px solid var(--ds-border);
    border-radius: var(--ds-radius-sm);
    outline: none;
    transition: border-color .2s ease, box-shadow .2s ease;
    box-sizing: border-box;
}

.ds-form__input::placeholder {
    color: #94a3b8;
}

.ds-form__input:focus {
    border-color: var(--ds-primary);
    box-shadow: 0 0 0 3px rgba(245, 158, 11, .15);
}

.ds-form__input:hover:not(:focus) {
    border-color: #cbd5e1;
}

.ds-form__hint {
    font-size: 0.8125rem;
    color: var(--ds-text-muted);
    line-height: 1.4;
}

.ds-form__actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 0.5rem;
}

/* ── Buttons ── */
.ds-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    font-family: var(--ds-font);
    font-size: 0.9375rem;
    font-weight: 600;
    border-radius: var(--ds-radius-sm);
    border: none;
    cursor: pointer;
    text-decoration: none;
    transition: all .2s ease;
    line-height: 1.4;
}

.ds-btn--primary {
    background: var(--ds-gradient);
    color: #fff;
    box-shadow: 0 2px 8px rgba(245, 158, 11, .25);
}

.ds-btn--primary:hover {
    box-shadow: 0 4px 14px rgba(245, 158, 11, .35);
    transform: translateY(-1px);
}

.ds-btn--primary:active {
    transform: translateY(0);
    box-shadow: 0 1px 4px rgba(245, 158, 11, .2);
}

.ds-btn--secondary {
    background: var(--ds-surface);
    color: var(--ds-text-muted);
    border: 1px solid var(--ds-border);
}

.ds-btn--secondary:hover {
    background: var(--ds-surface-alt);
    color: var(--ds-text);
    border-color: #cbd5e1;
}

/* ── Info List ── */
.ds-info {
    display: flex;
    flex-direction: column;
}

.ds-info__row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 0.875rem 0;
    border-bottom: 1px solid var(--ds-border);
    gap: 1rem;
}

.ds-info__row:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.ds-info__row:first-child {
    padding-top: 0;
}

.ds-info__label {
    font-size: 0.9375rem;
    font-weight: 500;
    color: var(--ds-text-muted);
    flex-shrink: 0;
}

.ds-info__value {
    font-size: 0.9375rem;
    color: var(--ds-text);
    text-align: right;
}

.ds-info__value--highlight {
    font-weight: 700;
    color: var(--ds-primary-dark);
}

/* ── Responsive ── */
@media (max-width: 640px) {
    .ds-page {
        padding: 0 0.75rem 2rem;
    }

    .ds-hero {
        padding: 1.25rem;
    }

    .ds-hero__title {
        font-size: 1.25rem;
    }

    .ds-hero__icon {
        width: 44px;
        height: 44px;
    }

    .ds-hero__back {
        width: 36px;
        height: 36px;
    }

    .ds-card__header {
        padding: 1rem 1.25rem;
    }

    .ds-card__body {
        padding: 1.25rem;
    }

    .ds-form__row {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .ds-form__actions {
        flex-direction: column-reverse;
        gap: 0.75rem;
    }

    .ds-btn {
        width: 100%;
        justify-content: center;
    }

    .ds-info__row {
        flex-direction: column;
        gap: 0.25rem;
    }

    .ds-info__value {
        text-align: left;
    }
}
</style>
{% endblock %}
